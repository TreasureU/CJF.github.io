<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS,Python,Unity" />





  <link rel="alternate" href="/atom.xml" title="Cheng JianFeng's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/logo.jpg?v=5.1.0" />






<meta name="description" content="iOS,Python,Unity">
<meta property="og:type" content="website">
<meta property="og:title" content="Cheng JianFeng's Blog">
<meta property="og:url" content="https://treasureu.github.io/page/6/index.html">
<meta property="og:site_name" content="Cheng JianFeng's Blog">
<meta property="og:description" content="iOS,Python,Unity">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cheng JianFeng's Blog">
<meta name="twitter:description" content="iOS,Python,Unity">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '6369437447528383000',
      author: '健康哥哥'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://treasureu.github.io/page/6/"/>





  <title> Cheng JianFeng's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Cheng JianFeng's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">心有猛虎,细嗅蔷薇.</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th-list"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/Effective Objective-C 2.0读书笔记：系统框架/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/Effective Objective-C 2.0读书笔记：系统框架/" itemprop="url">
                  Effective Objective-C 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/Effective Objective-C 2.0读书笔记：系统框架/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/Effective Objective-C 2.0读书笔记：系统框架/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="author" content="程剑锋"><meta name="created" content="2016-03-16 08:30:30 +0000"><meta name="updated" content="2016-03-17 10:08:18 +0000"><title>Effective Objective-C 2.0读书笔记：系统框架</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><ul><li>关于遍历collection元素的方法（共有四种，效率依次提高）：
<ul><li>简单的for循环</li><li>使用OC1.0中的NSEnumerator，该类的使用方法：（其优点在于有<b>l两种类型的遍历枚举器</b>）
<ul><li>[collection objectEnumerator/keyEnumerator]：获取一个NSEnumerator对象。</li><li>有些collection，如数组中有 reverseObjectEnumerator方法。</li><li>[NSEnumerator nextObject]：获取下一个object对象，直至nil。</li><li>[NSEnumerator allObjects]: 获取所有对象的数组</li></ul></li><li>for-in循环，只要是实现了 NSFastEnumeration协议的类即可使用。（非并发模式下最快）</li><li>基于块的遍历方式：基本模式是 -(void)enumrateXXXXXUsingBlock:( xxxx block )；其优点在于：
<ul><li>由于block的模式基本为 ^( id object … )，我们可以修改块的方法签名，将id类型替换为我们想要的类型。这主要是<b>基于id类型方法参数可以被任何类型覆写</b>。这样做的优点在于，如果我们明确某个collection中元素的类型必须是某种类型，那么覆写后编译器将帮我们完成对于该对象方法调用上的正确与否。</li><li>我们可以使用复杂的带有 NSEnumerationOptions 的方法调用，该参数可以指定 是否并发遍历（NSEnumerationConcurrent，其采用GCD并发队列实现并发），以及是否 反向遍历（NSEnumerationReverse）。采用 位或操作符连接，默认传入0即可。</li></ul></li></ul></li><li>使用无缝桥接技术（<b>仅在ARC下需要使用，MRC不需要</b>），可以在定义于Foundation框架的OC对象与定义在CoreFoundation框架中的C数据结构之间相互转换，具体可以参考<a href="evernote:///view/2147483647/s39/131bf35a-099e-4ce2-82dc-cf051ee94a3f/131bf35a-099e-4ce2-82dc-cf051ee94a3f/" style="color:#69aa35;" target="_blank" rel="external">无缝桥接技术详解</a></li><li>使用NSCache构建缓存：<a href="evernote:///view/2147483647/s39/3123aad0-730b-4fdd-ba17-a2639f523980/3123aad0-730b-4fdd-ba17-a2639f523980/" style="color:#69aa35;" target="_blank" rel="external">NSCache使用指南</a></li><li>NSTimer使用指南：<a href="evernote:///view/2147483647/s39/63710ce2-f860-425c-8186-962580b2191d/63710ce2-f860-425c-8186-962580b2191d/" style="color:#69aa35;" target="_blank" rel="external">NSTimer使用指南</a>&nbsp;&nbsp;&nbsp;&nbsp;</li><li>类的初始化方法（ load + initialize ）使用指南：<a href="evernote:///view/2147483647/s39/3895ffef-fb7f-4a2d-a7c6-c8156a3b47cb/3895ffef-fb7f-4a2d-a7c6-c8156a3b47cb/" style="color:#69aa35;" target="_blank" rel="external">类的初始化方法使用指南</a></li></ul></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/Effective Objective-C 2.0读书笔记：熟悉OC/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/Effective Objective-C 2.0读书笔记：熟悉OC/" itemprop="url">
                  Effective Objective-C 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/Effective Objective-C 2.0读书笔记：熟悉OC/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/Effective Objective-C 2.0读书笔记：熟悉OC/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="author" content="程剑锋"><meta name="created" content="2016-03-09 03:19:30 +0000"><meta name="updated" content="2016-03-11 05:46:22 +0000"><title>Effective Objective-C 2.0读书笔记：熟悉OC</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><ul><li>消息与函数调用的区别：关键区别在于，使用消息结构的语言，使用了其运行时所应执行的代码是由运行环境决定的。而使用了函数调用的语言，则由编译器决定。如果范例代码中调用的函数是多态的。那么在运行时就需要按照“虚函数表”来查出到底应该执行哪个函数实现。而采用消息结构的语言，无论是否多态，总是在运行时才会查找所要执行的方法。</li><li>对象总是分配在堆上，而不是栈上。因此与创建结构体相比，创建对象还需要额外的开销，例如分配和释放堆内存等。</li><li>由于头文件的展开是依次进行的，那么在OC中使用 #import 指令，在 循环引用 发生时，也不会导致死循环，但会其中一个文件将无法被正确的编译。</li><li>使用字面量创建的字符串、数组和字典对象都是不可变的。使用字面量时，如果想要放入nil，那么可以用[NSNull null] 对象代替，切不可直接使用，否则将会引起crash。</li><li>宏指令是在预编译阶段替换的，且替换的有效范围是以编译单元为单位的。即只有引入这个宏的头文件中的内容，才会被替换。由此可以引出编译原理的三大阶段：</li><li style="list-style: none; display: inline"><ul><li>以.m文件为一个编译单元，展开各自编译单元内的头文件。</li><li>对每个编译单元进行预编译处理、编译等操作，输出obj文件。</li><li>对所有的obj文件进行链接，形成程序文件。</li></ul></li></ul><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 宏定义展开正是在第二步中完成的。 </div><div><ul><li>使用常量定义代替宏定义，在使用上会更加安全。定义的格式请参照 ：</li><li style="list-style: none; display: inline"><ul><li>只在当前编译单元内可以见的： static 类型 const 变量名 = .......；</li><li>在外部编译单元可见： （定义） 类型 const 变量名 = .....; &nbsp;&nbsp;&nbsp;&nbsp;（外部引用） extern 类型 const 变量名 &nbsp;&nbsp;= .....； </li><li>注意，我们需要将声明放在.h中，将定义放在.h中。这才是良好的编程习惯。</li><li>如果是 static ，那么放在.h 和 .m 中都无所谓，但建议还是按照规范来。</li></ul></li><li>使用系统宏定义来定义枚举，需要进行位操作组合的枚举使用NS_OPTION宏，只是简单列举的宏，使用NS_ENUM宏。</li></ul></div></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/Effective Objective-C 2.0读书笔记：内存管理/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/Effective Objective-C 2.0读书笔记：内存管理/" itemprop="url">
                  Effective Objective-C 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/Effective Objective-C 2.0读书笔记：内存管理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/Effective Objective-C 2.0读书笔记：内存管理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="author" content="程剑锋"><meta name="created" content="2016-03-14 02:53:06 +0000"><meta name="updated" content="2016-03-14 07:51:02 +0000"><title>Effective Objective-C 2.0读书笔记：内存管理</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><ul><li>关于自动释放池 <b>@autoreleasepool</b> ，其会在稍后将对象的引用计数减1（池子释放时），而不会立即减1。如果不是自己添加的释放池，那么释放的时机通常是在下一次“事件循环”时发生。</li><li>在使用ARC简化引用计数写法，不仅可以提升开发效率，还可以提升运行效率。因此以下原因：</li><li style="list-style: none; display: inline"><ul><li>ARC添加的内存管理语句都是C函数，避开了消息调用流程，加快了执行速度。（还要注意，这意味着我们对release等消息的覆盖是无效的）</li><li>ARC包含运行期组件，能自动检测成对的互斥语句，比如函数返回时autorelease 和 外部变量对其执行的retain操作，它在识别到这些操作时，将通过一个标志位对这些操作进行标记，而避免调用 autorelease 和retain语句，从而加快了速度。（当然，这对我们来说是透明的）</li></ul></li><li>ARC内存管理规则：</li><li style="list-style: none; display: inline"><ul><li>ARC下，<b>内存管理语义成为硬性规定</b>。以 <b>alloc &nbsp;&nbsp; new &nbsp;&nbsp; copy &nbsp;&nbsp; mutableCopy 返回的对象，其持有权归调用者所</b>有。而其他函数返回的对象会自动执行一次 autorelease ，（当然外部接收的变量会自动做一次 retain），具体可以参考 P123。</li><li>在ARC时，默认情况下，每个变量都是指向对象的强引用。</li><li>其对于生成的属性方法的自动内存管理语句是：<b>先保留新值（tmp），再释放旧值，最后设置实例变量</b>。这是最安全的属性设置方式。</li><li>ARC只能管理Objective-C对象，但是比如 CoreFoundtion中的对象等C语言对象还是需要自己管理内存的。</li><li>使用ARC后不可覆盖 release &nbsp;&nbsp;retain &nbsp;&nbsp;autorelease 等语句，否则会干扰ARC分析对象的生命期的工作。</li></ul></li><li>dealloc方法只执行一次，也就是引用计数降为0时执行，但具体何时执行，不做保证。且在程序中，会有极个别对象，在应用终止时，仍处于存活状态，这些对象不会收到daalloc消息。如果一定要清理这些对象那么可以在 -(void)applicationWillTerminate:(UIApplication*)application 中完成操作。</li><li>建议的dealloc方法编写原则：</li><li style="list-style: none; display: inline"><ul><li>在dealloc中不要调用属性的存取方法。</li><li>在dealloc中优先完 通知监听的解除，以及 KVO监听的解除。</li><li>dealloc不应该出现异步线程的操作。</li></ul></li><li>关于异常安全代码： <a href="evernote:///view/8887184/s39/b45d7eb6-c69d-455d-b84d-9907aa6b4724/b45d7eb6-c69d-455d-b84d-9907aa6b4724/" style="color:#69aa35" target="_blank" rel="external">IOS异常处理机制</a></li><li>在大量产生临时对象的地方，或者大的<b>fou循环<font color="#BA00FF">内部</font></b>一定要添加添加上 @autoreleasepool （不要担心频繁执行的效率问题），这样能及时回收临时变量，有效的降低内存峰值。（当时spotlight里就是这么做的，图片格式转换产生了大量的临时对象，需要用这种方法去及时回收）</li><li>启用僵尸对象调试内存问题，僵尸对象在接收到消息后会抛出异常，并输出打印，其中包含对象类型和消息方法。关于僵尸对象的实现原理，具体来说分为以下几步：</li><li style="list-style: none; display: inline"><ul><li>运行期系统如果检测到NSZombieEnabled，那么就会将dealloc方法调配（” <a href="evernote:///view/8887184/s39/b2ccbffb-6930-4ea5-a18e-42b8db02c809/b2ccbffb-6930-4ea5-a18e-42b8db02c809/" style="color:#69aa35" target="_blank" rel="external">IOS方法调配技术</a>“）。</li><li>在修改后的dealloc中执行以下几步：用旧类的名字生成名为 _NSZombie_xxxx 的僵尸类，并注册到runtime中；执行旧类对象的dealloc语句（但不回收内存）；将旧类对象的isa指针指向新类。</li><li>改写僵尸类的消息转发机制（” <a href="evernote:///view/8887184/s39/df58eaac-06c3-4ad5-9684-bd8247555275/df58eaac-06c3-4ad5-9684-bd8247555275/" style="color:#69aa35" target="_blank" rel="external">IOS方法转发机制</a>“），使其可以响应任何方法并统一传递到一个地方处理。</li><li>在处理消息的地方，打印输出 旧类名 和 消息名 以及 实例对象指针，然后 abort() 程序。</li></ul></li><li>retainCount是不可靠的，主要是由于以下原因：</li><li style="list-style: none; display: inline"><ul><li>它只反映某个给定时间点上的保留计数值，但这个值不考虑已执行的但还未生效的autorelease调用。</li><li>系统有时候会优化对象释放行为，在保留技术为1时即回收，那么这个值永远不归0.</li><li>系统会尽量把 NSString对象实现为单例对象（那么它的保留计数将是MAX）。对于整形的NSNumber，系统也会 ”标签指针“的模式优化（可能），此时也会导致保留计数失效。参考可见P147.</li></ul></li><li><b>基于以上原因，请绝对不要用retainCount</b>。</li></ul></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/Effective Objective-C 2.0读书笔记：对象、消息、运行期/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/Effective Objective-C 2.0读书笔记：对象、消息、运行期/" itemprop="url">
                  Effective Objective-C 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/Effective Objective-C 2.0读书笔记：对象、消息、运行期/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/Effective Objective-C 2.0读书笔记：对象、消息、运行期/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="altitude" content="21.9205379486084"><meta name="author" content="程剑锋"><meta name="created" content="2016-03-08 10:35:09 +0000"><meta name="latitude" content="31.22305424322017"><meta name="longitude" content="121.3561700731711"><meta name="source" content="desktop.mac"><meta name="updated" content="2016-03-10 02:58:03 +0000"><meta name="application-data:corenote-localUUID" content="B4157980-AB5D-4212-B901-0160B17955B8"><meta name="application-data:corenote-hostUUID" content="4D185068-9BCF-48E1-BA86-2004C933D40C"><title>Effective Objective-C 2.0读书笔记：对象、消息、运行期</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><ul><li>属性有4大特质：原子特质、读写权限、内存管理特质、方法名定制化</li><li>开发IOS时一般使用 nonatomic ，因为IOS基本都是单线程操作的。在开发MAC OSX时使用 atomic 基本不会遇到瓶颈问题。</li><li>我们可以直接定义变量，或者是使用属性生成变量。对于属性生成的变量来说，是生成在.m文件中，即外部完全不可见（包括子类）。对于直接定义的变量，默认是 @protected，即外部类型不可直接访问，但子类可以。可以使用@public来改变.h中变量的<b>访问权限</b>。</li><li>在初始化方法中(init等)，应该直接使用 实例变量来赋值，因为属性方法可能在子类中被改写，从而与预期不一致。对于类内部的其他时候，合理的访问方式应该是：在写入实例变量时，总是采用属性方法。而访问则采用直接访问实例变量的方式获取。</li><li>关于 [xxx class] 的返回值，这个方法是每个具体类的类方法，其返回的是自身。那么就分为两种情况：</li><li style="list-style: none; display: inline"><ul><li>对于实例对象调用class方法：其返回自己所属的类。</li><li>对于类对象调用class方法：其返回自身。 &nbsp;&nbsp;&nbsp;&nbsp; 因此， <b>循环调用的结果就是，每次返回值都是一致的</b>。</li></ul></li><li>ios中有很多类型其都具有类族的概念，比如 UIButton，我们通过 buttonWithType: 返回的是其基类下某一个具体子类的实例变量。而基类通常 包含了对下面具体子类的接口抽象。这个概念很重要，这意味这我们<b>平时使用的大多数控件都是一个类族形式，而指针均是基类的指针</b>。</li><li>判断对象的类和类族的方法：</li><li style="list-style: none; display: inline"><ul><li>isKindOfClass: 可以比较前者是否属于后者的类族。其比较范围是 ： <b>以后者开始为根类，展开的类族树中，是否包含前者的类型</b>。</li><li>isMemberOfClass: 严格比较前者和后者的类型是否一致。</li><li>&nbsp;&nbsp;== ： 其实和第二种是一样的。</li></ul></li><li>关于对象等同性判断：通过 hash 和 isEqualTo: （在这里面，我们首先需要实现的就是对其类型判断是否一致）这两个函数一致，那么就表示这两个对象是等同的（不一定是同一个对象）。因此，若想判断某个类型的对象是否相等，请提供这两个函数。</li><li>关于 hash 函数，在NSObject 的默认实现中，其是直接返回指针地址。对于其他系统类，系统会根据其内容的不同，返回不同的hash值。（这是很好的可以利用的一点）。关于我们的自定义类，要实现高效且正确的hash函数必须满足以下要求：</li><li style="list-style: none; display: inline"><ul><li>在 isEqualTo： 返回YES时，其hash值必须相等。（这是一种约定，也是NSSet高效插入的一种机制）</li><li>提取出类中的<b>不可变系统类型</b>，获取他们的hash值。（不可变是因为，防止其在插入NSSet后，hash值又发生变化，最终会导致NSSet中出现重复对象）</li><li>组合第二步中的所有hash值，得到一个最终的hash值。（可通过加减运算或者位运算得到）</li></ul></li><li>当我们想要编写系统类型的子类时，我们需要覆写超类文档中指明的需要覆写的方法。这个一般在文档中会写明。</li><li>使用关联对象的方式，可以把两个对象连接起来。详情参见P41。注意，在链接时，其键值是个指针值，我们通过这个键值设入对象，也需要通过这个键值获取对象。因此，这个键值我们通常采用 常量字符串变量 来表示： static NSString* const xxxxx = @"xasdasda"; . &nbsp;&nbsp;我们可以用这个方法来伪造属性，即把 get/set 方法放在 属性的获取和设置函数中。</li><li>关于 &nbsp;&nbsp;<a href="evernote:///view/8887184/s39/df58eaac-06c3-4ad5-9684-bd8247555275/df58eaac-06c3-4ad5-9684-bd8247555275/" style="color:#69aa35" target="_blank" rel="external">IOS方法转发机制</a><b>P46</b>&nbsp;&nbsp;和 &nbsp;&nbsp;<a href="evernote:///view/8887184/s39/b2ccbffb-6930-4ea5-a18e-42b8db02c809/b2ccbffb-6930-4ea5-a18e-42b8db02c809/" style="color:#69aa35" target="_blank" rel="external">IOS方法调配技术</a><b>P53</b>&nbsp;&nbsp;将单独开辟文章来详述。</li><li>isa表示了一种的对象的从属关系（包括类对象），表示新建这个对象的类型是哪一个/这个对象属于哪个类型。而superclass则指明了类的继承关系。</li></ul><div><br></div></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/Effective Objective-C 2.0读书笔记：接口与API设计/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/Effective Objective-C 2.0读书笔记：接口与API设计/" itemprop="url">
                  Effective Objective-C 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/Effective Objective-C 2.0读书笔记：接口与API设计/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/Effective Objective-C 2.0读书笔记：接口与API设计/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="altitude" content="10.08357810974121"><meta name="author" content="程剑锋"><meta name="created" content="2016-03-12 14:20:47 +0000"><meta name="latitude" content="31.1974285104281"><meta name="longitude" content="121.3632029963981"><meta name="source" content="desktop.mac"><meta name="updated" content="2016-09-16 03:50:16 +0000"><title>Effective Objective-C 2.0读书笔记：接口与API设计</title></head><body>
<ul>
<li>在编写自己的代码时，主要是<b>类、C函数和全局变量（非static）</b>这类全局可见的符号表，一定要注意加上前缀（<b>苹果默认保留两个字的类名前缀</b>，所以我们要从三个字开始使用）避免命名空间冲突。</li>
<li>在编写自己的第三方framework和静态库时，除了需要遵守第一条守则外，还需要注意，如果在库的内部额外引入了第三方库，那么需要对<b>第三方库的所有类名进行修改</b>，同样的是<b>以添加上自己的类前缀为好</b>。这样就避免了，如果别人同时引入了我们的库和这个第三方库，会造成编译冲突的问题。</li>
<li>属性的读取特质限制，仅能限制通过属性方法对属性变量的操作，但直接对属性变量的操作，是无法通过读取特质来限制的。比如在类内部直接访问属性的实例变量，以及通过KVC直接对属性变量进行赋值等。</li>
<li>针对每个类，我们应该至少提供一个全能初始化方法，编写多个全能初始化方法的依据是，这些方法的初始化过程完成不一致则可以这么做。比如 initWithParam  和 initWithCoder 。在这些全能初始化方法中，应该根据super的情况来调用它的函数（可能不一定是和当前初始化函数名字相同的方法，甚至是相差甚远的方法）。</li>
<li>对于 super的所有初始化方法，理论上我们都应该进行覆盖。对于一些不能使用的，直接 @throw NSException 即可，或者直接返回nil。（建议使用前者，这样程序更加清晰）</li>
<li>在 <b>NSLog %@</b> 时，会调用相应对象的 <b>description</b> 方法。其默认实现是返回类名 和 指针地址。我们可以覆盖它返回更加详细的数据。（<b>%p 是指针的意思</b>）。在使用 <b>po 对象</b>时，调用的是 <b>debugDescription</b>方法，此时我们根据自己的需要可以返回更加详细的数据。</li>
<li>我们对外暴露的属性，应该尽量是readonly的，而且只在确有必要时才将属性对外公布。为了在类的内部完全打开读写权限，可以在 类的分类中将该属性重新设置为 readwrite。</li>
<li>建议对私有方法加上前缀，这样可以在调试和阅读时一目了然。建议使用“p_”作为前缀。同时不要使用“_”作为前缀，因为这是苹果对自己私有方法的前缀。</li>
<li>理解OC错误模型：<a href="evernote:///view/2147483647/s39/b45d7eb6-c69d-455d-b84d-9907aa6b4724/b45d7eb6-c69d-455d-b84d-9907aa6b4724/" style="color:#69aa35;" target="_blank" rel="external">IOS异常处理机制</a></li>
</ul>
</body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/Effective Objective-C 2.0读书笔记：块与GCD/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/Effective Objective-C 2.0读书笔记：块与GCD/" itemprop="url">
                  Effective Objective-C 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/Effective Objective-C 2.0读书笔记：块与GCD/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/Effective Objective-C 2.0读书笔记：块与GCD/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="author" content="程剑锋"><meta name="created" content="2016-03-14 07:51:15 +0000"><meta name="updated" content="2016-06-14 07:41:47 +0000"><title>Effective Objective-C 2.0读书笔记：块与GCD</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><ul><li>IOS有监视进程，如果一个app的主线程阻塞太久，那么将会被系统杀死。</li><li>Clang是xcode的编译器</li><li>block相关知识：<a href="evernote:///view/2147483647/s39/b75f09b1-3442-4577-9b08-de5c9d9041f5/b75f09b1-3442-4577-9b08-de5c9d9041f5/" style="color:#69aa35;" target="_blank" rel="external">block使用方法</a></li><li>使用block相较于delegate的形式：可以有效的降低代码分散程度。</li><li>关于使用多个回调还是一个块回调，建议使用一个块来回调：（以网络回调举例）：</li><li style="list-style: none; display: inline"><ul><li>调用的代码可以根据自己的需要来处理问题，而不是简单的划分为两类。</li><li>通用代码可以最大程度上实现复用。</li></ul></li><li>关于代码同步块的写法：</li><li style="list-style: none; display: inline"><ul><li>使用锁对象： NSLock对象（同线程不可重入，否则将死锁）；NSRecursiveLock递归锁，同一线程能多次持有该锁。</li><li>使用 @synchronized（xxx）方法：同步语法。</li><li>使用 ”串行同步队列“：新建一个串行队列，然后想需要互斥操作的代码放入这个串行队列中执行。代码详细参见P167. GCD相对于锁机制而言，由于其是相当底层的C语言代码，因此效率上会有所优化，且可以明确GCD内任务的执行顺序，完成更多复杂的操作等。</li></ul></li><li>对于GCD而言，我们需要明确两个特质：</li><li style="list-style: none; display: inline"><ul><li>同步（sync）还是异步( async )：同步或者是异步，是针对于调用者而言，指其<b>是否需要等待 block执行完成才能继续往下执行代码</b>。</li><li>串行还是并行：这个<b>取决于queue是 串行队列还是并行队列</b>。（即便是并行队列，也要考虑其是否有设置Target，其有可能不是真正的并行队列）</li></ul></li><li><b>关于同步和异步的效率问题</b>：异步派发有一个隐藏的block copy操作（因为要异步执行），而同步派发是没有的。因此，并不是异步派发效率上一定优于同步派发（更何况有时我们是不能使用异步派发的，比如下面的代码依赖于block执行结果时），如果 block内代码不复杂，那么copy操作的额外消耗可能大于异步带来的好处，引发效率降低。</li><li>在并发queue的代码块中，为了达到串行执行某些任务的功能，需要使用 <b>dispatch_barrier_async</b>( dispatch_queue_t queue, dispatch_block_t block ) 和<b>&nbsp;&nbsp;dispatch_barrier_sync</b>( dispatch_queue_t queue, dispatch_block_t block )。</li><li>performSelector的方法缺点：（可以考虑使用GCD代替）</li><li style="list-style: none; display: inline"><ul><li>如果传入的 SEL 是动态变化的，那么ARC无法判定返回值的类型，也不知道是否需要将返回值release。鉴于此，ARC采用较为谨慎的方式，统一不释放返回值，由此可能引发内存泄露问题。</li><li>performSelector的返回值默认是id类型，需要转化为其他类型则需要进过转化步骤。且如果执行函数的返回值为C语言结构体，则不可以使用performSelector方法。</li><li>performSelector的选择子是id类型，如果方法接受基本类型那么将不能使用performSelector。</li><li>performSelector存在参数个数限制，如果超过3个参数以上，就需要另外想办法执行。</li></ul></li><li>OC中有对GCD的高层封装，即NSOperationQueue. GCD是纯C的API，而NSOperationQueue则是OC的对象，其<b>优势</b>如下：（但效率和易用性上不如GCD）</li><li style="list-style: none; display: inline"><ul><li>可以取消某个操作。在任务加入queue后，我们可以对该 operation执行cancel，如果任务还未被调度，那么它不会被调度。而如果任务已经开始，无法自动取消，但是我们可以在任务的main内定期检测cancel标志位，以达到此效果。</li><li>可以指定 operation之间的依赖关系，这对于并发队列特别有效。可以参考：http://www.2cto.com/kf/201504/390735.html 。只需要对&nbsp;&nbsp;[blockOp2 <b>addDependency:</b>blockOp1]; 即可。</li><li>可以指定操作的优先级。比如 [o3 setQueuePriority:NSOperationQueuePriorityHigh]; 可以参考：http://blog.csdn.net/kiki1985/article/details/8734999</li><li>NSOperation对象可以定制化，且易于在代码中重用</li></ul></li><li>GCD并发队列中，执行任务实际所需的并发线程数量，取决于各种因素，而GCD主要是根据系统资源状况来判定这些因素的。（即你无法确定实际有多少个线程）</li><li>单例的最佳实现方案：建议采用 dispatch_once 来执行只需运行一次的线程安全代码。此方式效率最高，几乎是 @synchronized的两倍。</li><li>GCD队列可以设置层级关系 &nbsp;&nbsp;dispatch_set_target_queue( queueB, queueA )，一旦设置了层级关系，那么 queueB 上的block 实际将在 queueA 的线程中执行。但我们无法为 系统的GCD 设置依赖关系，它们只能作为 层级的顶端。</li><li style="list-style: none; display: inline"><ul><li>因为可以设置 target关系，GCD可以呈现一种树状层级结构。</li><li>因为 sync在同一个 串行GCD上执行时将导致死锁，而 可以设置Target使这种问题变得越发复杂。</li><li>要检测Target的设置关系：我们需要为每个queue添加标记，然后在使用时检测标记，来判断Target关系。详情可以参见：P183。</li><li>dispatch_get_current_queue 可以获取当前队列，用于避免一些简单的死锁，但是一旦设置了Target，则无法有效的使用这种机制避免。建议采用上一条的方式来避免死锁。&nbsp;&nbsp;</li></ul></li><li>GCD总结： <a href="evernote:///view/8887184/s39/4abc06ca-4df2-4ec1-80ab-c47e4b45c831/4abc06ca-4df2-4ec1-80ab-c47e4b45c831/" style="color:#69aa35" target="_blank" rel="external">GCD使用方式与效果总结</a></li><li><b>GCD上的死锁出现条件</b>：只有采用sync方式，并最终在 串行队列中执行时，才会引发block。</li></ul></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/iOS核心动画高级编程：读书笔记/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/iOS核心动画高级编程：读书笔记/" itemprop="url">
                  iOS核心动画高级编程：读书笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/iOS核心动画高级编程：读书笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/iOS核心动画高级编程：读书笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="altitude" content="20.48523902893066"><meta name="author" content="程剑锋"><meta name="created" content="2016-02-29 08:40:55 +0000"><meta name="latitude" content="31.22305266657873"><meta name="longitude" content="121.3562200125848"><meta name="source" content="desktop.mac"><meta name="source-url" content="http://blog.csdn.net/u013523426/article/details/50945164"><meta name="updated" content="2016-09-26 09:48:48 +0000"><title>iOS核心动画高级编程：读书笔记</title></head><body>
<div>
<div><b>iOS设备图形显示架构：</b></div>
<div><img src="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/6A8C3537-B909-4852-9DB9-BEB4872CBE3B.png" height="198" width="294"></div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
<div><b><br></b></div>
<div><b>ios设备情况概览</b>：<a href="http://iosres.com/" target="_blank" rel="external">http://iosres.com/</a></div>
<div><br></div>
<div><br></div>
<div><b>示例演示代码</b>：<a href="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/CoreAnimationTest-master.zip">CoreAnimationTest-master.zip</a></div>
<div><br></div>
<div><br></div>
<div><b>CALayer基础属性</b>：</div>
<ul>
<li>每一个layer都可以分为 背景层 + 寄宿图层（content层）</li>
<li><b>CALayer并不支持自动大小和自动布局</b>。</li>
<li><span style="color: rgb(50, 135, 18);">layer的<b>坐标系相关属性</b></span>：
<ul>
<li>layer的坐标系以左上角为原点的。</li>
<li>主要属性：frame、bounds、postion、 <span style="color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif; font-size: 14px; background-color: rgb(255, 255, 255);">anchorPoint、transform</span>
<ul>
<li>frame：由<b>其它几个变量经过计算后得出</b>，直接改变它的值，可以影响 view 的 size和postion。<b>frame的位置基准点永远都是左上角的点</b>。</li>
<li>bounds：决定layer 的 size。</li>
<li>postion：它指明了锚点相对于父图层的位置，从而可以影响layer的位置。</li>
<li>anchorPoint：以锚点为基准点，确定layer的位置。<b>锚点还是layer做图形变换时的支点</b>。</li>
<li><span style="color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif; font-size: 14px; background-color: rgb(255, 255, 255);">transform：可以决定矩形变换原则。可以在position不变的情况下，改变layer的位置等。</span></li>
</ul>
</li>
<li><span style="color: rgb(51, 51, 51);">坐标属性之间的相互关系：</span>
<ul>
<li><span style="color: rgb(51, 51, 51);">layer的size影响：bounds 和 frame</span></li>
<li><span style="color: rgb(51, 51, 51);">layer的position影响：</span>anchorPoint 和 position 和 frame（frame本质上是通过改变）</li>
<li><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">即frame决定了该</span></font><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">layer</span></font><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">在 superL</span></font><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">ayer</span></font><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">中的位置，而 bounds决定了其 本地坐标系，该坐标系将决定其 subL</span></font><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">ayer</span></font><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">的布局。而本地坐标系的定位，就是相当于</span></font> <font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">layer</span></font><font face="Helvetica Neue, Helvetica, STheiti, 微软雅黑, 黑体, Arial, Tahoma, sans-serif, serif" color="#333333"><span style="font-size: 14px;">的 bounds.origin 在本地坐标系的相应位置，然后反推出原点位置即可。</span></font></li>
<li>view的布局其实就是layer布局的一层封装，最后直接取的是layer中的值。</li>
</ul>
</li>
</ul>
</li>
<li><span style="color: rgb(50, 135, 18);">layer的<b>寄宿图有两种生成方式</b></span>：
<ul>
<li>layer的content赋值
<ul>
<li>直接对content属性进行赋值</li>
<li>layer的delegate的<u>- (void)displayLayer:(CALayer *)layer中对layer的content进行赋值。</u></li>
</ul>
</li>
<li>使用Custom Drawing绘制：
<ul>
<li>UIView的drawRect函数就是对自己封装的layer的一次绘制。</li>
<li>layer的delegate的<u>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</u> 就是对layer的一次绘制。</li>
<li>这种方式存在<b>性能问题</b>：
<ul>
<li>一旦你实现了 CALayerDelegate 协议中的 -drawLayer:inContext: 方法或者 UIView 中的 -drawRect: 方法（其实就是前者的包装方法）<b>，图层就创建了一个绘制上下文，这个上下文需要的大小的内存可从这个算式得出：图层宽*图层高*4字节，宽高的单位均为像素。对于一个在Retina iPad上的全屏图层来说，这个内存量就是 2048*1526*4字节，相当于12MB内存，图层每次重绘的时候都需要重新抹掉内存然后重新分配</b>.</li>
<li>绘制一般需要使用Core Graphics，而软件绘制的效率远不如硬件对图像处理的速度来的快。最好使用一些专用的layer子类，去实现硬件加速，完成性能优化。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><span style="color: rgb(50, 135, 18);">layer的<b>内容相关属性</b></span>：
<ul>
<li>contentGravity：content的放置方式。（与UIview的contentMode类似）</li>
<li>contentScale：寄宿图像素与点的比例关系。（即[UIScreen mainScreen].scale），因为CGImage没有scale的概念，因此如果layer的这个值设置不正确的话，图像可能会模糊展示。因此，最好手动设置为当前屏幕的scale。</li>
<li>maskToBounds:截断边界展示。</li>
<li>contentRect：一个相对的Rect值，表示展示content中的哪个区域的内容</li>
<li>contentCenter：一个相对的Rect值。九宫格划分，表示content拉伸时，哪个区域是不可拉伸的。可以在xib上直接设置（stretching栏）</li>
</ul>
</li>
<li><span style="color: rgb(50, 135, 18);">layer的<b>视觉效果属性</b></span>：
<ul>
<li>圆角效果：connerRadius，设置的是圆角半径。一般只影响背景而不影响寄宿图和子图层。需要配合maskToBounds才能对content产生截断效果。</li>
<li>图形边框：borderWidth 和 borderColor。<b> 边框是绘制在图层边界里面的（确保不会被maskToBounds截断）,而且在所有子内容之前,也在子图层之前（会覆盖在所有子图层上方）</b>。</li>
<li>阴影效果：
<ul>
<li>shadowOpacity：阴影透明度【0.0，1.0】</li>
<li>shadowColor：阴影颜色，CGColorRef</li>
<li>shadowOffset：阴影的偏移方向，CGSize值。（+x向右，+y向下）。苹果更倾向于阴影是垂直向下的。</li>
<li>shadowRadius：阴影的模糊度，即它与边界的分割清晰度。为0时有明确的分割，越大越模糊。</li>
<li>shadowPath：指定任意阴影的形状，这可以加快阴影的绘制速度，并达到定制化的效果。（建议添加）</li>
<li>需要注意的是，<span style="color: rgb(148, 33, 146);"><b>阴影是根据content内容的外形来计算阴影的，而不是layer的大小或者是content的大小</b></span>。</li>
<li>阴影是不计算在边界大小内的，如果它超出边界范围，那么就可能会被 maskToBounds阶段。可以用两个图层解决这个问题：<b>一个只画阴影的空的外图 层,和一个用 masksToBounds 裁剪内容的内图层</b>。</li>
</ul>
</li>
<li>图层蒙版：mask，可以设置一个layer作为蒙版，只展示两个图层实心重叠的部分。
<ul>
<li>mask 图层的 Color 属性是无关紧要的,<b>真正重要的是图层的轮廓。 mask 属性就像是一个饼干切割机, mask 图层实心的部分会被保留下来,其他的则会被抛弃</b>。</li>
<li>CALayer蒙板图层真正厉害的地方在于蒙板图不局限于静态图。<b>任何有图层构成的都可以作为 mask 属性,这意味着你的蒙板可以通过代码甚至是动画实时生成</b>。</li>
</ul>
</li>
<li>拉伸过滤：minificationFilter（缩小过滤器）和 magnificationFilter（放大过滤器）。
<ul>
<li>重绘图片大小也没有一个统一的通用算法。这取决于需要拉伸的内容,放大或是缩小的需求等这些因素。 CALayer 为此提供了三种拉伸过滤方法,他们是:
<ul>
<li>kCAFilterLinear （默认）</li>
<li>kCAFilterNearest </li>
<li>kCAFilterTrilinear（效果与默认相近）</li>
</ul>
</li>
<li>对于比较小的图或者是差异特别明显,极少斜线的大图,最近过滤算法会保留这种差异明显的特质以现更好的结果。但是对于大多数的图尤其是有很多斜线或是曲线轮廓的图片来说,最近过滤算法会导致更差的结果。换句话说,线性过滤保留了形状,最近过滤则保留了像素的差异。</li>
</ul>
</li>
<li>组透明：使用 shouldRasterize来实现整个layer图层统一透明度。</li>
</ul>
</li>
<li><span style="color: rgb(50, 135, 18);">layer的<b>变换属性</b></span>：
<ul>
<li>CGAffineTransform：仿射变换，适用于2D坐标变换。
<ul>
<li>主要分为三大模块：Rotation（旋转，弧度单位，顺时针为正）、Scale（缩放）、Translation（平移）</li>
<li>这些效果是可以叠加使用的，只要在同一个CGAffineTransform对象上变换即可。</li>
<li>CGAffineTransform对象的生成和变换全部有现成的函数可以使用。</li>
<li><b>混合变换顺序问题</b>：
<ul>
<li>产生原因：当使用<span style="color: rgb(45, 79, 201);"><b>同一个CGAffineTransform 对象完成多种变换</b></span>时，变换的顺序会影响最终的结果，也就是说旋转之后的平移和平移之后的旋转结果可能不同。</li>
<li>具体现象：<b>先添加的变换，将影响之后的变换的值</b>。最明显的例子就是：先平移200，再缩放0.5的话，200的平移量是可以被确保的。但是先缩放0.5，再平移200的话，平移的量就只有100了。</li>
</ul>
</li>
</ul>
</li>
<li>CATransform3D：3D变换，适用于3D坐标变换。
<ul>
<li>主要分为三大模块：Rotation（旋转，弧度单位，以某个坐标轴为旋转轴旋转）、Scale（缩放，x,y,z均可缩放）、Translation（平移，x,y,z均可平移）</li>
<li>这些效果是可以叠加使用的，只要在同一个CATransform3D 对象上变换即可。</li>
<li><b>3D成像透视效果</b>的关键：
<ul>
<li>灭点：当在透视角度绘图的时候，远离相机视角的物体将会变小变远，当远离到一个极限距离，它们可能就缩成了一个点，于是所有的物体最后都汇聚消失在同一个点。在现实中，这个点通常是视图的中心，于是为了在应用中创建拟真效果的透视，<b>这个点应该聚在屏幕中点，或者至少是包含所有3D对象的视图中点</b>。</li>
<li>实现3D对象统一灭点的方案：在包含所有3D对象的父图层上，设置它的sublayerTransform属性，之后，我们就可以根据postion和frame自由的设置3D对象的位置了。具体代码示例如下：</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>//apply perspective transform to container</div>
<div>CATransform3D perspective = CATransform3DIdentity;</div>
<div>perspective.m34 = - 1.0 / 500.0;</div>
<div>self.containerView.layer.sublayerTransform = perspective;</div>
</div>
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li>m34的取值大小：1/( 500 - 1000) 就很不错了，分母的值代表透视的距离。减少距离可以增强透视效果，一个非常大的值将失去透视效果。</li>
</ul>
</li>
<li><b>3D旋转的叠加效应</b>：
<ul>
<li>现象：绕Z轴旋转时，实际上就是2D旋转，其效应是可以抵消的（即父图层上的正向变换和子图层上的反向变换，将导致子图层复原）。但是，绕X轴和Y轴旋转，是一种3D旋转，它是不会产生抵消效应的。</li>
<li>原因：这是由于<b>尽管Core Animation图层存在于3D空间之内，但它们并不都存在同一个3D空间。每个图层的3D场景其实是扁平化的，</b>当你从正面观察一个图层，看到的实际上由子图层创建的想象出来的3D场景，但当你倾斜这个图层，你会发现实际上这个3D场景仅仅是被绘制在图层的表面。</li>
<li>解决方案：如果希望一些3D对象共享一个3D空间，可以使用CATransformLayer，这是个特殊的CALayer子类，他可以使它的子图层处于同一个3D空间上。</li>
</ul>
</li>
<li><b>zPostion修改展示顺序</b>：修改zPostion可以调整图层在父图层中的展示顺序。<span style="color: rgb(255, 0, 0);"><b>添加到父图层中的顺序决定了图层树中的顺序，而图层树中的顺序决定了事件响应的顺序。当我们通过修改视图的zPostion改变显示的优先级，但这不会改变事件响应的顺序</b></span>。这就可能出现，视图展示在最前面，但是事件被后面的视图劫走了，因此，当我们修改zPostion时应该要小心这一点。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div><br></div>
<div><br></div>
<div><b>CALayer Custom Drawing绘制方式</b>：（详解）</div>
<ul>
<li><b>我们绘制的内容最终会转化为一个CGImage对象，传给CALayer使用</b>。即其实<b>CALayer只支持显示一种  content ====&gt; CGImage对象</b>。</li>
<li>有两种方式可以实现对图层的自定义绘制，绘制内容利用原生的Core Graphics方法实现的，具体实现如下：
<ul>
<li>当使用系统原生的layer时：
<ul>
<li>设置该layer的delegate，并在该delegate对象中实现CALayerDelegate中的 drawLayer:(CALayer*)layer inContext:(CGComtextRef)ctx 函数。（不需要声明实现CALayerDelegate 协议，因为在NSObject中已经默认实现了）</li>
<li>drawLayer:(CALayer*)layer inContext:(CGComtextRef)ctx 中完成绘制工作。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>-(void)drawInContext:(CGContextRef)ctx{</div>
<div>    UIImage *image=[UIImage imageNamed:@"luhan.jpg"];</div>
<div>    CGContextDrawImage(ctx, CGRectMake(0, 0, 200, 200), image.CGImage);</div>
<div>}</div>
</div>
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li>当使用自己实现的CALayer子类时，我们可以实现 -drawInContext: 方法来实现绘制。</li>
</ul>
</li>
<li>在这里顺带可以说一下CALayer的几个关键函数：
<ul>
<li>display :　用于更新layer的content内容（绘制内容也是content内容的一种）。首先，判断是否有delegate实现 了 displayLayer: 方法，有的话就直接返回相应的数；否则生成 context，并且在内部调用 drawInContext ，然后更新 layer的content属性。<b>不要直接调用这个函数</b>。</li>
<li>drawInContext ：当delegate没有实现 了 displayLayer: 方法时，会被调用。调用后，会在内部调用delegate的 drawLayer:(CALayer*)layer inContext:(CGComtextRef)ctx 方法。</li>
<li>seetNeedDisplay: 表示layer需要更新内容，并在合适的时候更新layer。</li>
<li>displayeIfNeeded：表示立即更新layer。</li>
</ul>
</li>
</ul>
<div><br></div>
<div><br></div>
<div><b>嵌入CALayer生命周期中的delegate方法</b>：</div>
<ul>
<li><u>- (void)displayLayer:(CALayer *)layer</u>：如果定义了这个方法，那么将在layer的 -display 方法中调用。它应该实现全部的display的流程，典型的就是设置layer的content属性。</li>
<li><u>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</u>：如果定义了这个方法，那么将在layer的 -drawInContext: 中调用。</li>
<li><u>- (void)layoutSublayersOfLayer:(CALayer *)layer</u>：在 -layoutSublayers 中被调用，且在 layer manager 被检查之前。如果delegate的方法正在被调用，那么 manager将被忽略。</li>
<li><u>- (nullable id&lt;CAAction&gt;)actionForLayer:(CALayer *)layer forKey:(NSString *)event</u>：如果定义了这个方法，那么将在 -actionForKey:  中被调用。这个方法应该返回一个实现了 CAAction 协议的对象。如果delegate没有为某一个event指定行为，那么可以返回nil。返回一个[NSNull null]对象，可以明确的表示不再进行进一步的搜索。</li>
</ul>
<div><br></div>
<div><br></div>
<div><b>CALayer的子类划分</b>：</div>
<ul>
<li><span style="color: rgb(50, 135, 18);"><b>CAShapeLayer</b></span>：形状绘制图层。所有可以用CGPath表示的形状，都可以用CAShapeLayer来绘制。当然，我们也可以用Custom Drawing+Core Graphics来完成绘制和展示。
<ul>
<li>CAShapeLayer有以下优点：
<ul>
<li>渲染快速，有硬件加速支持。</li>
<li>高效使用内存，不像CALayer创建同等大小的寄宿图用于绘制，它无论多大，都不会占用很大的内存。</li>
<li><b>不会被图层边界裁剪掉</b>。</li>
<li>不会出现像素化。</li>
</ul>
</li>
<li>你可以控制一些属性比如 lineWith （线宽，用点表示单位）， lineCap （线条结尾的样子），和 lineJoin （线条之间的结合点的样子）；但是在图层层面你只有一次机会设置这些属性（需要在绘制前设置）。如果你想用不同颜色或风格来绘制多个形状，就不得不为每个形状准备一个图层了。</li>
<li>代码示例：</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>UIBezierPath *path = [[UIBezierPath alloc] init];</div>
<div>[path moveToPoint:CGPointMake(175, 100)];</div>
<div>[path addArcWithCenter:CGPointMake(150, 100) radius:25 startAngle:0 endAngle:[path moveToPoint:CGPointMake(150, 125)];</div>
<div>[path addLineToPoint:CGPointMake(150, 175)];</div>
<div>[path addLineToPoint:CGPointMake(125, 225)];</div>
<div>[path moveToPoint:CGPointMake(150, 175)];</div>
<div>[path addLineToPoint:CGPointMake(175, 225)];</div>
<div>[path moveToPoint:CGPointMake(100, 150)];</div>
<div>[path addLineToPoint:CGPointMake(200, 150)];</div>
<div>//create shape layer</div>
<div>CAShapeLayer *shapeLayer = [CAShapeLayer layer];</div>
<div>shapeLayer.strokeColor = [UIColor redColor].CGColor;</div>
<div>shapeLayer.fillColor = [UIColor clearColor].CGColor;</div>
<div>shapeLayer.lineWidth = 5;</div>
<div>shapeLayer.lineJoin = kCALineJoinRound;</div>
<div>shapeLayer.lineCap = kCALineCapRound;</div>
<div>shapeLayer.path = path.CGPath;</div>
<div>//add it to our view</div>
<div>[self.containerView.layer addSublayer:shapeLayer];</div>
</div>
<ul>
<li><span style="color: rgb(50, 135, 18);"><b>CATextLayer</b></span>：文件展示图层。使用Core Text引擎渲染，效率高于UILabel。如果希望开发效率高些，可以使用Text Kit。综合来说：
<ul>
<li>简单且性能要求高的：CATextLayer</li>
<li>复杂且性能要求高的：Text Kit</li>
<li>简单无性能要去的：UILabel</li>
</ul>
</li>
<li><span style="color: rgb(50, 135, 18);"><b>CATransformLayer</b></span>：3D对象空间共享图层，是一个容器图层，可以使加入其中的子图层共享一个3D空间。方便做统一的3D变换。</li>
<li><span style="color: rgb(50, 135, 18);"><b>CAGradientLayer</b></span>：渐变色图层。使用硬件加速，性能好。
<ul>
<li>指定位置渐变代码示例：</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>//create gradient layer and add it to our container view</div>
<div>CAGradientLayer *gradientLayer = [CAGradientLayer layer];</div>
<div>gradientLayer.frame = self.containerView.bounds;</div>
<div>[self.containerView.layer addSublayer:gradientLayer];</div>
<div>//set gradient colors</div>
<div>gradientLayer.colors = @[(__bridge id)[UIColor redColor].CGColor, (__bridge //set locations</div>
<div>gradientLayer.locations = @[@0.0, @0.25, @0.5];</div>
<div>//set gradient start and end points</div>
<div>gradientLayer.startPoint = CGPointMake(0, 0);</div>
</div>
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li>colos：决定了有几种颜色参与渐变</li>
<li>locations:决定了每种颜色结束的位置。但是即使设为0或者1，那种颜色还是会参与边缘渐变</li>
<li>startPoint和endPoint：决定了渐变开始和结束的位置，提供了一个向量方向。但是没有在这个范围里的内容，将使用单色填充。</li>
</ul>
</li>
<li>简单渐变代码示例：</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>//create gradient layer and add it to our container view</div>
<div>CAGradientLayer *gradientLayer = [CAGradientLayer layer];</div>
<div>gradientLayer.frame = self.containerView.bounds;</div>
<div>[self.containerView.layer addSublayer:gradientLayer];</div>
<div>//set gradient colors</div>
<div>gradientLayer.colors = @[(__bridge id)[UIColor redColor].CGColor, (__bridge //set gradient start and end points</div>
<div>gradientLayer.startPoint = CGPointMake(0, 0);</div>
</div>
<ul>
<li><span style="color: rgb(50, 135, 18);"><b>CAReplicatorLayer</b></span>：迭代变换对象图层。
<ul>
<li>这个图层在复制子图层时，连<b>子图层的动画效果等都可以原封不动的copy过去，而且还可以设置copy图层的时间间隔</b>。拷贝时的属性变化时直接作用于当时子图层的实际属性上的。</li>
<li>代码示例：</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>//create a replicator layer and add it to our view</div>
<div>CAReplicatorLayer *replicator = [CAReplicatorLayer layer];</div>
<div>replicator.frame = self.containerView.bounds;</div>
<div>[self.containerView.layer addSublayer:replicator];</div>
<div>//configure the replicator</div>
<div>replicator.instanceCount = 10;</div>
<div>//apply a transform for each instance</div>
<div>CATransform3D transform = CATransform3DIdentity;</div>
<div>transform = CATransform3DTranslate(transform, 0, 200, 0);</div>
<div>transform = CATransform3DRotate(transform, M_PI / 5.0, 0, 0, 1);</div>
<div>transform = CATransform3DTranslate(transform, 0, -200, 0);</div>
<div>replicator.instanceTransform = transform;</div>
<div>//apply a color shift for each instance</div>
<div>replicator.instanceBlueOffset = -0.1;</div>
<div>replicator.instanceGreenOffset = -0.1;</div>
<div>//create a sublayer and place it inside the replicator</div>
<div>CALayer *layer = [CALayer layer];</div>
<div>layer.frame = CGRectMake(100.0f, 100.0f, 100.0f, 100.0f);</div>
<div>layer.backgroundColor = [UIColor whiteColor].CGColor;</div>
<div>[replicator addSublayer:layer];</div>
</div>
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li>效果示例：<img src="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/B3710679-3A14-4F87-A21D-E23EAB61539B.png" height="716" width="1458"></li>
<li>适合使用的场景：反射（它可以对加入的多个子layer，做相同的变换）、轨迹变化等</li>
</ul>
</li>
<li><b>CAScrollLayer</b>：滑动图层。UIScrollView 并没有用 CAScrollLayer ，事实上，就是简单的通过直接操作图层边界来实现滑动。</li>
<li><span style="color: rgb(50, 135, 18);"><b>CATiledLayer</b></span>：大图分步载入图层。CATiledLayer 为载入大图造成的性能问题提供了一个解决方案：将大图分解成小片然后将他们单独按需载入。
<ul>
<li>操作步骤：
<ul>
<li>将大图分割为小图，分成不同文件保存。</li>
<li>设置CATiledLayer的大小为图片的大小。</li>
<li>设置CATiledLayer的delegate，实现分步加载图片。</li>
</ul>
</li>
<li>代码示例如下：</li>
</ul>
</li>
</ul>
<div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);">
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)viewDidLoad</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">[super viewDidLoad];</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//add the tiled layer</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">CATiledLayer *tileLayer = [CATiledLayer layer];</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">tileLayer.frame = CGRectMake(0, 0, 2048, 2048);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">tileLayer.delegate = self; [self.scrollView.layer addSublayer:tileLayer];</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//configure the scroll view</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">self.scrollView.contentSize = tileLayer.frame.size;</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//draw layer</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">[tileLayer setNeedsDisplay];</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">}</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)drawLayer:(CATiledLayer *)layer inContext:(CGContextRef)ctx</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//determine tile coordinate</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">CGRect bounds = CGContextGetClipBoundingBox(ctx);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">NSInteger x = floor(bounds.origin.x / layer.tileSize.width);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">NSInteger y = floor(bounds.origin.y / layer.tileSize.height);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//load tile image</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">NSString *imageName = [NSString stringWithFormat: @"Snowman_%02i_%02i", NSString *imagePath = [[NSBundle mainBundle] pathForResource:imageName];</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">UIImage *tileImage = [UIImage imageWithContentsOfFile:imagePath];</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//draw tile</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">UIGraphicsPushContext(ctx);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">[tileImage drawInRect:bounds];</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">UIGraphicsPopContext();</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">}</span></span></span></div>
</div>
<ul>
<li><b>CAEmitterLayer</b>：粒子效果图层。</li>
<li><b>CAEAGLLayer</b>：OpenGL展示图层。</li>
<li><b>AVPlayerLayer</b>：视频播放图层。AVPlayerLayer 是用来在iOS上播放视频的。他是高级接口例如 MPMoivePlayer 的底层实现，提供了显示视频的底层控制。 AVPlayerLayer 的使用相当简单：你可以用 +playerLayerWithPlayer: 方法创建一个已经绑定了视频播放器的图层，或者你可以先创建一个图层，然后用 player 属性绑定一个 AVPlayer 实例。
<ul>
<li>准备工作：我们需要添加AVFoundation到我们的项目中。</li>
<li>代码示例：</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>//get video URL</div>
<div>NSURL *URL = [[NSBundle mainBundle] URLForResource:@"Ship" withExtension:@"//create player and player layer</div>
<div>AVPlayer *player = [AVPlayer playerWithURL:URL];</div>
<div>AVPlayerLayer *playerLayer = [AVPlayerLayer playerLayerWithPlayer:player];</div>
<div>//set player layer frame and attach it to our view</div>
<div>playerLayer.frame = self.containerView.bounds;</div>
<div>[self.containerView.layer addSublayer:playerLayer];</div>
<div>//play the video</div>
<div>[player play];</div>
</div>
<div><br></div>
<div><br></div>
<div><br></div>
<div><span style="color: rgb(28, 51, 135);"><b>可以用于实现动画的方式</b></span>：</div>
<ol>
<li>隐式动画，仅能作用于单一属性。</li>
<li>基本属性动画：CABasicAnimation，仅能作用于单一属性。</li>
<li>关键帧动画：CAKeyFrameAnimation，仅能作用于单一属性。</li>
<li>动画组：CAAnimationGroup，可以包含CABasicAnimation 和 CAKeyFrameAnimation</li>
<li>过渡动画：CATransition，用于图层大范围动画变化。</li>
<li>UIView提供的动画组接口、关键帧动画接口和过渡动画接口。</li>
<li>NSTimer/CADispalyLink实现的关键帧动画</li>
</ol>
<div><br></div>
<div><br></div>
<div><b>CALayer隐式动画</b>：（隐式动画是CABasicAnimation的一种）</div>
<ul>
<li>CALayer的基本属性几乎都是支持隐式动画的，直接修改这些属性值，都会引发默认的隐式动画。动画默认时长为0.25s。</li>
<li>UIView对CALayer做了一次封装，它实现了CALayerDelegate中的 <b>- (nullable id&lt;CAAction&gt;)actionForLayer:(CALayer *)layer forKey:(NSString *)event</b> 的代理方法，针对隐式动画的操作，全部都返回nil。只有UIView的显示动画，才会返回正确的action对象，去执行动画。（注意，属性值的改变不是在这一步做的，这一步只是动画）
<ul>
<li>这个代理方法其实是在 layer的 actionForKey 这个函数中被调用。它的具体步骤如下：</li>
<li>图层首先检测它是否有委托,并且是否实现 CALayerDelegate 协议指定的 - actionForLayer:forKey 方法。如果有,直接调用并返回结果。 如果没有委托,或者委托没有实现 方法,图层接 着检查包含属性名称对应行为映射的   字典。（但在这一步可以返回[NSNull null]对象，提前结束搜索）</li>
<li>如果 actions字典 没有包含对应的属性,那么图层接着在它的 style 字典接 着搜索属性名。</li>
<li>最后,如果在 style 里面也找不到对应的行为,那么图层将会直接调用定义 了每个属性的标准行为的 -defaultActionForKey: 方法。</li>
<li>所以一轮完整的搜索结束之后, 要么返回空(这种情况下将不 会有动画发生),要么是 协议对应的对象,最后 CALayer 拿这个结果 去对先前和当前的值做动画。</li>
</ul>
</li>
<li>在动画执行过程中，图层属性值保存的是动画结束后的值（即最终值），当前图层的属性其实是保存在一个 presentationLayer中的，我们如果想知道当前屏幕上layer的实时信息的话，获取这个 presentationLayer 的属性才是正确的值。</li>
<li>从上面可以知道，我们的显示层级可以分为：图层树  -&gt;  呈现数  -&gt;  渲染树（后面提及）</li>
<li>CATransaction的常用方法：
<ul>
<li>【CATransaction begin】 + 【CATransaction commit】：用于组成一个事务，动画的执行是以事务为单位执行的。run loop 会自动把一次 run loop周期内的隐式动画打包成一个事务来执行。</li>
<li>【CATransaction setDuration:】:设置即将执行的下一个事务的持续时间。只作用于下一个事务。不设置的话，默认为0.25s。</li>
<li>【CATransaction setDisableActions：】：默认为NO，设置为YES后，下一个隐式动画的事务提交时，将不会执行动画，而是立即发生变化。注意，有效期只有一次。</li>
</ul>
</li>
<li>我们可以针对某一个具体的属性值，设置自定义动画，以覆盖默认的隐式动画，达到定制化的效果。
<ul>
<li>步骤：只需要生成一个 符合CAAction协议的对象后，将它作为一个键值对添加到 layer.actions 这个字典中去就好了。</li>
</ul>
</li>
</ul>
<div><br></div>
<div><br></div>
<div><b>CALayer</b> <b>显式动画</b>：</div>
<ul>
<li>显式动画：可以对一些指定的属性做自定义动画，或者是完成非线性的变化操作。</li>
<li><b>显式动画不会真正的改变layer的属性值</b>，它带来的只是动画上的变化。如果我们希望在显示动画完成后，同时修改界面的值，那么请在 addAnimation 后，再直接修改属性的值。（建议可以立即执行）
<ul>
<li>修改属性值，<b>必须关闭隐式动画</b>，否则将会产生两个动画效果。</li>
<li>具体操作步骤：创建一个事务【CATransaction begin】，设置【CATransaction setDisableActions：YES】，然后修改属性值，最后提交这个事务【CATransaction commit】。</li>
</ul>
</li>
<li><b>公有属性设置</b>：
<ul>
<li>duration：持续时间</li>
<li><b>由于CAAnimation对象是支持KVC的</b>，所以我们可以使用 【layer_var setValue:xxx forKey:xxx】来完成附加自定义变量。（比如我们可以把对象的layer绑定到animation对象上，[animation setValue:handView forKey:@"handView"]; 这样就可以在回调发生是，非常简单的获取到layer了）</li>
</ul>
</li>
<li><b>添加或者删除操作：</b></li>
</ul>
<div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);">
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">添加一个动画到CALayer,anim传入后会进行一次深拷贝，最后回调中出现的对象也是深拷贝后的对象（无法靠比较指针来判断是哪个动画），因此建议传入key值，然后通过 </span></span></span><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">animationForKey： 判断是哪个动画。</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)addAnimation:(CAAnimation *)anim forKey:(nullable NSString *)key;</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br></span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">移除layer上已经添加的所有animation</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)removeAllAnimations;</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br></span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">移除layer上指定key的animation</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)removeAnimationForKey:(NSString *)key;</span></span></span></div>
<div><br></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">返回一个数组包含所有当前已加入layer的animation的key。需要注意的是，当一个动画执行结束后，它就自动被移除了。</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (nullable NSArray&lt;NSString *&gt; *)animationKeys;</span></span></span></div>
<div><br></div>
<div>返回一个指定key值的animation对象</div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (nullable CAAnimation *)animationForKey:(NSString *)key;</span></span></span></div>
</div>
<ul>
<li><b>显式动画的分类</b>：
<ul>
<li>隐式动画：CABasicAnimation，作用于单一属性。属性动画的一种。
<ul>
<li>keyPath：决定了需要设置的属性对象key值</li>
<li>toValue：绝对值赋值</li>
<li>byValue：相对值赋值</li>
</ul>
</li>
<li>关键帧动画：CAKeyFrameAnimation，作用于单一属性。属性动画的一种。
<ul>
<li>keyPath：决定了需要设置的属性对象key值</li>
<li>由于动画在开始时会突然从原有的属性值变到第一帧的值，然后在结束时会从最后一帧的值突然变回属性值。因此，建议第一帧和最后一帧的动画帧值要与当时的属性值保持一致。</li>
<li>需要注意的是，整个动画是以一个恒定的速度在变化的，并没有在缓冲区时减速/加速，这会导致看起来比较奇怪。因此，我们将使用在以后的章节对它做出改变。</li>
<li>values：普通属性的关键桢变化</li>
<li>path：点属性的变化路线</li>
<li>rotationMode：表示变化过程中元素的朝向（不变或者是沿着曲线切边）</li>
</ul>
</li>
<li>显示动画组：CAAnimationGroup 可以把属性动画和关键帧动画组合在一起。(CABasicAnimation 和 CAKeyframeAnimation 仅仅作用于单独的属性)
<ul>
<li>animations：显示动画数组</li>
<li>加入到动画组的动画如果不指定duration，那么将使用动画组的duration。当然也可以指定duration，那么将优先使用各个动画自己的duration。</li>
</ul>
</li>
<li>过渡动画： CATransition，用于完成属性动画无法设置的一些变化。比如 layer 的 content 变化，整个图层的remove 和 add 操作等。
<ul>
<li>type：决定了动画的显示效果。
<ul>
<li>kCATransitionFade 默认的过渡类型 ，当你在改变图层属性之后，就创建了一个平滑的淡入淡出效果。</li>
<li>kCATransitionPush ，它创建了一个新的图层，从边缘的一侧滑动进来，把旧图层从另一侧推出去的效果。</li>
<li>kCATransitionMoveIn 实现了一个定向滑动的动画,从顶部滑动进入，但不像推送动画那样把老土层推走。</li>
<li>kCATransitionReveal 也实现了一个定向滑动的动画，但是有一些细微的不同，kCATransitionReveal 把原始的图层滑动出去来显示新的外观，而不是把新的图层滑动进入。</li>
</ul>
</li>
<li>subtype：决定了动画的进入方向。（后面三种type有subtype这个选项）
<ul>
<li>kCATransitionFromRight</li>
<li>kCATransitionFromLeft</li>
<li>kCATransitionFromTop</li>
<li>kCATransitionFromBottom</li>
</ul>
</li>
<li><b>注意</b>：对于指定的图层，一次只能添加一个 CATransition 动画。（而属性动画一次是可以添加多个的）。添加一次，动画效果将在下次图层变化时生效，有效期只有一次。</li>
<li>CATransision 可以对图层任何变化平滑过渡的事实使得它成为那些不好做动画的属性图层行为的理想候选。苹果当然意识到了这点，并且当设置了 CALayer 的 content 属性的时候， CATransition 的确是默认的行为。但是被视图包裹的图层这一特性也是被禁用的。</li>
<li><b>使用技巧</b>：要确保 CATransition 添加到的图层在过渡动画发生时不会在树状结构中被移除，否则 CATransition 将会和图层一起被移除。一般来说，<b>你只需要将动画添加到被影响图层的 superlayer</b> 。</li>
<li>UIView层级的封装：是苹果通过 UIView +transitionFromView:toView:duration:options:completion: 和 +transitionWithView:duration:options:animations: 方法提供了Core Animation的过渡特性。但是这里的可用的过渡选项和 CATransition 的 type 属性提供的常量完全不同。</li>
</ul>
</li>
</ul>
</li>
<li><b>虚拟属性赋值</b>：CAAnimation在做动画时是支持虚拟属性设置的。
<ul>
<li>比如你不可以直接设置 transform.rotation 或者 transform.scale ，他们不能被 直接使用。当你对他们做动画时，Core Animation自动地根据通 过 CAValueFunction 来计算的值来更新 transform 属性。 CAValueFunction 用于把我们赋给虚拟的 transform.rotation 简单浮点值转 换成真正的用于摆放图层的 CATransform3D 矩阵值。你可以通过设 置 CAPropertyAnimation 的 valueFunction 属性来改变，于是你设置的函数将 会覆盖默认的函数。</li>
<li>因此，我们可以设置值 ：（目前已知的是transform.rotation  和 transform.scale  可用）</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>CABasicAnimation *animation = [CABasicAnimation animation];</div>
<div>animation.keyPath = @"transform.rotation";</div>
<div>animation.duration = 2.0;</div>
<div>animation.byValue = @(M_PI * 2);</div>
<div>[shipLayer addAnimation:animation forKey:nil];</div>
</div>
<div><br></div>
<ul>
<li style="display:inline;list-style:none;">
<ul>
<li>这一种设置值的方式，<b>对于 transform 属性非常有用</b>。</li>
</ul>
</li>
<li><b>回调函数</b>：</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>当动画开始执行签被调用</div>
<div>- (void)animationDidStart:(CAAnimation *)anim;</div>
<div><br></div>
<div>当动画完成或者被绑定的对象移除时，都会被调用。当动画完成后被调用时，flag是true，否则为false。</div>
<div>- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag;</div>
</div>
<div><br></div>
<div><br></div>
<div><b>动画增删操作</b>：</div>
<ul>
<li><b>显示动画一旦被移除（隐式动画无法移除），图层的外观就立刻更新到当前的模型图层（是model层，而不是呈现presentation层）的值</b>。一般说来，动画在结束之后被自动移除，除非设置 removedOnCompletion 为 NO ，如果你设置动画在结束之后不被自动移除，那么当它不需要的时候你要手动移除它；否则它会一直存在于内存中，直到图层被销毁。</li>
<li><b>所有的动画在执行过程中添加新的动画的话，他们会一起生效的</b>。</li>
</ul>
<div><br></div>
<div><b>动画持久化的方式</b>：</div>
<ul>
<li>方式一：在动画add会立即修改 layer的属性。此时 frame 属性已经变化。</li>
<li>方式二：removedOnCompletion 为 NO，此时frame属性没有变化。</li>
</ul>
<div><br></div>
<div><br></div>
<div><b>CAMediaTiming协议</b>：（利用时间操纵动画的方式）</div>
<ul>
<li>CoreAnimation有一个全局时间的概念，也就是所谓的马赫时间。马赫时间在设备上所有进程都是全局的--但是在不同设备上并不是全局的--不过这已经足够对动画的参考点提供便利了，你可以使用 CACurrentMediaTime 函数来访问马赫时间。<b>注意当设备 休眠的时候马赫时间会暂停，也就是所有的 CAAnimations （基于马赫时间）同样也会暂停</b>。</li>
<li>每个layer还有自己的一个本地时间概念：<img src="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/FB7D2ECC-6112-45A9-8416-117444BF8349.png" height="240" width="568"></li>
<li>动画也存在层级关系：
<ul>
<li>一个是通过 CALayer的图层树确定的层级关系（所有作用于一个layer上的动画都是这个layer的子动画）。</li>
<li>一个是通过CAAnimation的group完成的动画组。</li>
</ul>
</li>
<li>CALayer和CAAnimation都实现了 CAMediaTiming协议，该协议可以使动画对象和图层对象自由的控制他们的动画（包括子动画）的时间属性。</li>
<li>协议的具体参数：
<ul>
<li><b>beginTime</b>:设置动画的延迟执行时间。（<b>可以影响子动画</b>）默认是0。</li>
<li><b>duration</b>：单次正向动画的预期执行时间。（与实际执行时间还要参考其它因素）</li>
<li><b>speed</b>：动画的执行速度，默认是1。<span style="color: rgb(186, 0, 255);"><b>它和duration决定了动画 的真正执行时间</b></span>。越大则速度越快，实际执行时间越短，否则反之。（<b>可以影响子动画</b>）。为0 的时候可以暂停动画的执行，负值时，可以反向执行动画。<b>speed 可以影响duration和beginTime,但是无法影响 timeoffset</b>.（例如：当speed=2.0时，一个duration=1.0的动画，将在0.5s内就执行完成）</li>
<li><b>timeOffset</b>：表示动画执行的起点在整个动画的偏移时间位置和结束位置。默认是0.（<b>可以影响子动画</b>）使用这个属性和speed可以控制动画的播放效果。或者将动画暂停，由其控制图层展示到动画的某一帧的状态。值范围在【0,duration/speed】之间，超出大小将进行取余数操作。<b>当变更起点后，图层会执行动画，最后回到起点状态。（即动画的实际执行时间不变）</b></li>
<li><b>repeatCount</b>:重复次数。设置为 INFINITY 表示无限循环。</li>
<li><b>repeatDuration</b>：重复时间。其与repeatCount不能一起设置，否则会产生未定义行为。设置为 INFINITY 表示无限循环。</li>
<li><b>fillMode</b>：表示动画开始前和动画结束后的图层状态。默认为kCAfILLModeRemoved。
<ul>
<li>kCAFillModeForwards ：动画开始前的状态是动画第一帧的效果。</li>
<li>kCAFillModeBackwards ：动画结束后的状态是动画最后一帧的效果。要求我们把animation.removeOnCompleted=NO（默认为YES，会在完成后移除）。但在之后，我们需要自己手动把动画从layer中移除，否则会引起内存泄露。</li>
<li>kCAFillModeBoth</li>
<li>kCAFillModeRemoved</li>
</ul>
</li>
</ul>
</li>
<li><b>动画的暂停、倒退和快进操作</b>：
<ul>
<li>暂停：使speed=0即可让动画暂停。由于无法改变已经添加到layer上的动画对象的属性，所以，我们可以改变layer的speed属性来达成这一目的。且由于layer的层级继承关系，在将会对其sublayer上的所有动画产生效果。（如果想要让application的所有动画都暂停或者减速，可以修改 window.layer.speed= 0）</li>
<li>慢放：设置一个[0,1]之间的speed，可以达到慢放的效果。</li>
<li>倒退：设置一个负值的speed，可以使动画反向执行。（<b>正负影响方向，绝对值影响速度</b>）</li>
<li>快进：设置一个大于0的speed可以达到快进的效果。</li>
</ul>
</li>
<li><b>手工动画</b>：
<ul>
<li>方法：timeOffset 一个很有用的功能在于你可以它可以让你手动控制动画进程，通过设置 speed 为0，可以禁用动画的自动播放，然后来使用 timeOffset 来来回显示动画序列。</li>
<li>场景：这对于一些复杂的组合图层变化来说，比如说关键帧这样更加复杂的情况，或者有多个图层的动画组，相对于实时计算每个图层的属性而言，这就显得方便的多了。</li>
</ul>
</li>
</ul>
<div><br></div>
<div><br></div>
<div><b>UIView动画接口</b>：</div>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>@interface UIView(UIViewAnimationWithBlocks) </div>
<div><br></div>
<div><b>属性动画接口（隐式动画、动画组等）</b><br></div>
<div>+ (void)animateWithDuration:(NSTimeInterval)duration delay:(NSTimeInterval)delay options:(UIViewAnimationOptions)options animations:(void (^)(void))animations completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(4_0);</div>
<div><br></div>
<div>+ (void)animateWithDuration:(NSTimeInterval)duration animations:(void (^)(void))animations completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(4_0); // delay = 0.0, options = 0</div>
<div><br></div>
<div>+ (void)animateWithDuration:(NSTimeInterval)duration animations:(void (^)(void))animations NS_AVAILABLE_IOS(4_0); // delay = 0.0, options = 0, completion = NULL</div>
<div><br></div>
<div>/* Performs `animations` using a timing curve described by the motion of a spring. When `dampingRatio` is 1, the animation will smoothly decelerate to its final model values without oscillating. Damping ratios less than 1 will oscillate more and more before coming to a complete stop. You can use the initial spring velocity to specify how fast the object at the end of the simulated spring was moving before it was attached. It's a unit coordinate system, where 1 is defined as travelling the total animation distance in a second. So if you're changing an object's position by 200pt in this animation, and you want the animation to behave as if the object was moving at 100pt/s before the animation started, you'd pass 0.5. You'll typically want to pass 0 for the velocity. */<br></div>
<div>+ (void)animateWithDuration:(NSTimeInterval)duration delay:(NSTimeInterval)delay usingSpringWithDamping:(CGFloat)dampingRatio initialSpringVelocity:(CGFloat)velocity options:(UIViewAnimationOptions)options animations:(void (^)(void))animations completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(7_0);</div>
<div><br></div>
<div><b>过渡动画接口</b><br></div>
<div>+ (void)transitionWithView:(UIView *)view duration:(NSTimeInterval)duration options:(UIViewAnimationOptions)options animations:(void (^ __nullable)(void))animations completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(4_0);</div>
<div><br></div>
<div>+ (void)transitionFromView:(UIView *)fromView toView:(UIView *)toView duration:(NSTimeInterval)duration options:(UIViewAnimationOptions)options completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(4_0); // toView added to fromView.superview, fromView removed from its superview</div>
<div><br></div>
<div>/* Performs the requested system-provided animation on one or more views. Specify addtional animations in the parallelAnimations block. These additional animations will run alongside the system animation with the same timing and duration that the system animation defines/inherits. Additional animations should not modify properties of the view on which the system animation is being performed. Not all system animations honor all available options.</div>
<div> */</div>
<div>+ (void)performSystemAnimation:(UISystemAnimation)animation onViews:(NSArray&lt;__kindof UIView *&gt; *)views options:(UIViewAnimationOptions)options animations:(void (^ __nullable)(void))parallelAnimations completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(7_0);</div>
<div><br></div>
<div>@end</div>
<div><br></div>
<div>@interface UIView (UIViewKeyframeAnimations)</div>
<div><br></div>
<div><b>关键帧动画接口</b></div>
<div>+ (void)animateKeyframesWithDuration:(NSTimeInterval)duration delay:(NSTimeInterval)delay options:(UIViewKeyframeAnimationOptions)options animations:(void (^)(void))animations completion:(void (^ __nullable)(BOOL finished))completion NS_AVAILABLE_IOS(7_0);</div>
<div>+ (void)addKeyframeWithRelativeStartTime:(double)frameStartTime relativeDuration:(double)frameDuration animations:(void (^)(void))animations NS_AVAILABLE_IOS(7_0); // start time and duration are values between 0.0 and 1.0 specifying time and duration relative to the overall time of the keyframe animation</div>
<div><br></div>
<div>@end</div>
</div>
<div><br></div>
<div><br></div>
<div><br></div>
<div><b>动画缓冲</b>：（即动画的变化速度控制）</div>
<ul>
<li>CALayer设置动画变化属性：创建 CAMediaTimingFunction ，最简单的方式是调用 +timingFunctionWithName: 的构造方法，内置类型如下：
<ul>
<li>kCAMediaTimingFunctionLinear ：该选项创建了一个线性的计时函数，同样也是 显示动画的 timingFunction <b>属性为空时候的默认函数</b>。线性步调对于那些立即加速并且保持匀速到达终点的场景会有意义。</li>
<li>kCAMediaTimingFunctionEaseIn：创建了一个慢慢加速然后突然停止的方法。</li>
<li>kCAMediaTimingFunctionEaseOut：以一个全速开始，然后慢慢减速停止。</li>
<li>kCAMediaTimingFunctionEaseInEaseOut：创建了一个慢慢加速然后再慢慢减速的过程。这是现实世界大多数物体移动的方式，也是大多数动画来说最好的选择。</li>
<li>kCAMediaTimingFunctionDefault（效果与EaseInEaseOut几乎没有区别）：<b>是隐式动画的默认方式，但不是显示动画的默认方式</b>。</li>
</ul>
</li>
<li>UIKit的动画也同样支持这些缓冲方法的使用，尽管语法和常量有些不同:
<ul>
<li>UIViewAnimationOptionCurveEaseInOut ：默认值。</li>
<li>UIViewAnimationOptionCurveEaseIn</li>
<li>UIViewAnimationOptionCurveEaseOut</li>
<li>UIViewAnimationOptionCurveLinear</li>
</ul>
</li>
<li>对动画设置指定的缓冲方式：
<ul>
<li><b>隐式动画</b>：如果想改变隐式动画的计时函数，同样也可以使用 CATransaction 的 +setAnimationTimingFunction: 方法。</li>
<li><b>显式动画</b>：需要设置 CAAnimation 的 timingFunction 属性，是 CAMediaTimingFunction 类的一个对象。</li>
<li><b>关键帧动画</b>：CAKeyframeAnimation 有一个 NSArray 类型的 timingFunctions 属性，我们可以用它来对每次动画的步骤指定不同的计时函数。但是指定函数的个数一定要等于 keyframes 数组的元素个数减一，因为它是描述每一帧之间动画速度的函数。</li>
</ul>
</li>
<li>自定义缓冲函数：（简单的缓冲变化可以用此方法实现）
<ul>
<li>缓冲函数的数学表示：<b>三次贝塞尔曲线</b>。
<ul>
<li>一个三次贝塞尔曲线通过四个点来定义，第一个和最后一个点代表了曲线的起点和终点，剩下中间两个点叫做控制点，因为它们控制了曲线的形状，贝塞尔曲线的控制点其实是位于曲线之外的点，也就是说曲线并不一定要穿过它们。你可以把它们想象成吸引经过它们曲线的磁铁。</li>
<li><img src="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/3987957D-AEA3-4879-841A-8224A5300F35.png" height="403" width="467"></li>
</ul>
</li>
<li>使用函数：一个有四个浮点参数的 +functionWithControlPoints:::: 。</li>
<li>代码示例：</li>
</ul>
</li>
</ul>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>    CAMediaTimingFunction* function = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div>
<div>    function = [CAMediaTimingFunction functionWithControlPoints:1 :0 :0.75 :1];</div>
<div>    float cp1[2];</div>
<div>    float cp2[2];</div>
<div>    [function getControlPointAtIndex:1 values:cp1];</div>
<div>    [function getControlPointAtIndex:2 values:cp2];</div>
<div><br></div>
<div>    UIBezierPath* bpath = [[UIBezierPath alloc] init];</div>
<div>    [bpath moveToPoint:CGPointZero];</div>
<div>    [bpath addCurveToPoint:CGPointMake(1, 1) controlPoint1:CGPointMake(cp1[0], cp1[1]) controlPoint2:CGPointMake(cp2[0], cp2[1])];</div>
<div>    [bpath applyTransform:CGAffineTransformMakeScale(200, 200)];</div>
<div><br></div>
<div>    CAShapeLayer* shl = [CAShapeLayer layer];</div>
<div>    shl.position = CGPointMake(100, 500);</div>
<div>    shl.strokeColor = [UIColor redColor].CGColor;</div>
<div>    shl.fillColor = [UIColor clearColor].CGColor;</div>
<div>    shl.lineWidth = 4.0f;</div>
<div>    shl.path = bpath.CGPath;</div>
<div>    shl.geometryFlipped = YES;</div>
<div>    [self.view.layer addSublayer:shl];</div>
</div>
<ul>
<li><b>复杂的缓冲变化方式</b>：
<ul>
<li>例如：<img src="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/401868A1-6D72-42FB-B1F6-2DEE7A73D970.png" height="462" width="548"></li>
<li>实现方式：
<ul>
<li>用 CAKeyframeAnimation 创建一个动画，然后分割成几个步骤，每个小步骤使用自己的计时函数，这里大致有两种方式：
<ul>
<li>自己划分的关键帧，然后填充每一段关键帧之间的缓冲函数。</li>
<li>使用<b>自动化流程采集海量关键帧</b>（数量在 60*duration左右），直接使用关键帧完成整个动画。
<ul>
<li>要求我们必须有相应动画的缓冲函数，这个可以在网站 复杂的速度变化曲线：<a href="https://github.com/warrenm/AHEasing" target="_blank" rel="external">https://github.com/warrenm/AHEasing</a>（C语言实现），可以用于自动提取关键帧动画。</li>
<li>有了这个函数后，我们只要封装一个函数，传入formValue 和 toValue ，以及  time，即可返回相应的中间态数据，然后将这个数据添加到关键帧动画的 values 中即可。</li>
</ul>
</li>
</ul>
</li>
<li>使用定时器逐帧更新实现动画（见第11章，“基于定时器的动画”）。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div><br></div>
<div><br></div>
<div><b>使用定时器实现关键帧动画</b>：</div>
<ul>
<li><b>CADisplayLink</b> 是CoreAnimation提供的另一个类似于 NSTimer 的类，它总是在屏幕完成一次更新之前启动，它的接口设计的和 NSTimer 很类似，所以它实际上就是一个内置实现的替代，但是和 timeInterval 以秒为单位不同， CADisplayLink 有一个整型的 frameInterval 属性，指定了间隔多少帧之后才执行。默认值是1，意味着每次屏幕更新之前都会执行一次。</li>
<li>CADisplayLink 会保证帧率足够连续，使得动画看起来更加平滑，但即使 CADisplayLink 也不能保证每一帧都按计划执行，一些失去控制的离散的任务或者事件（例如资源紧张的后台程序）可能会导致动画偶尔地丢帧。<b>当使用 NSTimer 的时候，一旦有机会计时器就会开启（一定会补偿执行），但是 CADisplayLink 却不一样：如果它丢失了帧，就会直接忽略它们，然后在下一次更新的时候接着运行</b>。</li>
<li>基于第二点特性，我们在刷新时，应该计算的是实际的刷新间隔，而不是使用固定的时间间隔去累加。计算实际时间间隔可以使用CACurrentMediaTime()多次获取时间然后取差值得到。</li>
<li>使用示例：<img src="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/9BA13562-0162-4D41-9637-A566DE163D40.png" height="147" width="523"></li>
<li>CADisplayLink和NSTimer一样，可以被加入多个不同模式的定时器：<img src="iOS%E6%A0%B8%E5%BF%83%E5%8A%A8%E7%94%BB%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.resources/F633796A-9701-4DE3-AD74-9C0FA634EDA2.png" height="345" width="541"></li>
</ul>
<div><br></div>
<div><br></div>
<div><b>软件绘图（Core Graphics）</b>：</div>
<ul>
<li>软件绘图不仅效率低，还会消耗可观的内存。
<ul>
<li>内存消耗的体现：一旦你实现了 CALayerDelegate 协议中的 -drawLayer:inContext: 方法或者 UIView 中的 -drawRect: 方法（其实就是前者的包装方法），图层就创建了一个绘制上下文，这个上下文需要的大小的内存可从这个算式得出：图层宽*图层高*4字节，宽高的单位均为像素。对于一个在Retina iPad上的全屏图层来说，这个内存量就是 2048*1526*4字节，相当于12MB内存，<b>图层每次重绘的时候都需要重新抹掉内存然后重新分配</b>.</li>
</ul>
</li>
<li>用Core Graphics来绘图的一个通常原因就是只是用图片或是图层效果不能轻易地绘制出矢量图形。矢量图形包括：
<ul>
<li>任意多边形（不仅仅是一个矩形）</li>
<li>斜线或曲线</li>
<li>文本</li>
<li>渐变</li>
</ul>
</li>
<li>性能优化基本方案：提高绘制性能（采用异步绘制、专门的layer类），以及减少绘制数量（脏矩形）</li>
<li><b>Core Animation为这些矢量图形类型的绘制提供了专门的类，并给他们提供硬件支持（如果可以满足要求，建议使用Core Animation代替Core Graphics）</b>，这些总体上都比Core Graphics更快，同时他们也避免了创造一个寄宿图。具体如下：
<ul>
<li>CAShapeLayer ：可以绘制多边形，直线和曲线。</li>
<li>CATextLayer ：可以绘制文本。</li>
<li>CAGradientLayer： 用来绘制渐变。</li>
</ul>
</li>
<li>脏矩形：在使用Core Graphics绘制图形时，每次变化可能不需要重绘整个layer的区域，那么可以指定只重绘部分的Rect。（以UIView为例）
<ul>
<li>[self setNeedsDisplayInRect:[self brushRectForPoint:point]]：设置需要更新的区域。</li>
<li>在 drawRect 中完成重绘。可以使用 CGRectIntersectsRect(rect, brushRect) 精确判断区域。</li>
</ul>
</li>
<li><b>异步绘制</b>：
<ul>
<li><b>CATiledLayer</b>：可以将图层再次分割成独立更新的小块（类似于脏矩形自动更新的概念）， CATiledLayer 还有一个有趣的特性：在多个线程中为每个小块同时调用 -drawLayer:inContext: 方法。这就避免了阻塞用户交互而且能够利用多核心新片来更快地绘制。只有一个小块的 CATiledLayer 是实现异步更新图片视图的简单方法。</li>
<li><b>CALayer的drawsAsynchronously属性</b>：
<ul>
<li>作用：它对传入 -drawLayer:inContext: 的CGContext进行改动，允许CGContext延缓绘制命令的执行以至于不阻塞用户交互。 它与 CATiledLayer 使用的异步绘制并不相同。它自己的 -drawLayer:inContext: 方法只会在主线程调用，但是CGContext并不等待每个绘制命令的结束。相反地，它会将命令加入队列，当方法返回时，在后台线程逐个执行真正的绘制。</li>
<li>使用场景：这个特性在需要频繁重绘的视图上效果最好（比如我们的绘图应用，或者诸如 UITableViewCell 之类的），对那些只绘制一次或很少重绘的图层内容来说没什么太大的帮助。</li>
</ul>
</li>
<li><b>异步线程执行绘制</b>：由于 <b>CoreGraphic 方法通常都是线程安全的，所以图像的绘制可以很容易的放到后台线程进行</b>。一个简单异步绘制的过程大致如下（实际情况会比这个复杂得多，但原理基本一致）：需要注意的是，由于要异步绘制，所以必须实现的是  displayLayer： 方法.</li>
</ul>
</li>
</ul>
<div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.148438);">
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)displayLayer:(CALayer*)layer</span></span></span><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    dispatch_async(backgroundQueue, ^{</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        CGContextRef ctx = CGBitmapContextCreate(...);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        // draw in context...</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        CGImageRef img = CGBitmapContextCreateImage(ctx);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        CFRelease(ctx);</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        dispatch_async(mainQueue, ^{</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            layer.contents = img;</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        });</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    });</span></span></span></div>
<div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">}</span></span></span></div>
</div>
<div><br></div>
<div><br></div>
<div><br></div>
<div><br></div>
<div><b>参考文章</b>：</div>
<ul>
<li>CAShapeLayer与贝塞尔曲线参考文章：<span style="color: rgb(61, 167, 66); font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif; font-size: 14px; widows: 1; background-color: rgb(255, 255, 255);"><a href="http://www.jianshu.com/p/c5cbb5e05075" target="_blank" rel="external">http://www.jianshu.com/p/c5cbb5e05075</a></span></li>
<li>Mask动画参考文章：<span style="color: rgb(61, 167, 66); font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif; font-size: 14px; widows: 1; background-color: rgb(255, 255, 255);"><a href="http://www.jianshu.com/p/3c925a1609f8" target="_blank" rel="external">http://www.jianshu.com/p/3c925a1609f8</a></span></li>
<li><a style="color:#69aa35" href="evernote:///view/8887184/s39/e8d4e8ff-7763-4622-9172-080c1b2f71d3/e8d4e8ff-7763-4622-9172-080c1b2f71d3/" target="_blank" rel="external">app性能问题定位与解决</a></li>
<li>CATransform3D vs. CGAffineTransform ： <a href="http://stackoverflow.com/questions/567829/catransform3d-vs-cgaffinetransform" target="_blank" rel="external">http://stackoverflow.com/questions/567829/catransform3d-vs-cgaffinetransform</a>  ，前者用于2D，后者用于3D。</li>
</ul>
<div><br></div>
<div><br></div>
</div>
</div>
</body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/Effective Objective-C 2.0读书笔记：协议与分类/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/Effective Objective-C 2.0读书笔记：协议与分类/" itemprop="url">
                  Effective Objective-C 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T14:28:38+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/Effective Objective-C 2.0读书笔记：协议与分类/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/Effective Objective-C 2.0读书笔记：协议与分类/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="读书笔记"><meta name="altitude" content="10.53390598297119"><meta name="author" content="程剑锋"><meta name="created" content="2016-03-13 13:07:06 +0000"><meta name="latitude" content="31.19730649845225"><meta name="longitude" content="121.3631884634351"><meta name="source" content="desktop.mac"><meta name="updated" content="2016-12-07 02:02:09 +0000"><title>Effective Objective-C 2.0读书笔记：协议与分类</title></head><body><ul>
<li>delegate方法和datasource方法最大的区别在于信息流的流向，delegate是从委托人流向被委托人，因此回调方法的返回值为void；而datasource则是从被委托人流向委托人，因此返回值不会void。</li>
<li>在设计 委托协议 时，<font color="#0433ff"><b>通常回调方法的第一个参数 都是委托对象自身</b>，因为被委托对象<b>可能同时兼任多个委托对象的delegate/datasource</b>，我们需要传入委托对象，才能正确的区分处理</font>。</li>
<li>如果在委托对象上调用协议的<b>可选方法</b>时，一定要使用  -(BOOL)respondsToSelector:(SEL) 判断是否存在，(注意该方法是 NSObject协议中声明的方法，因此如果希望我们的协议应该都继承于NSObject协议)。<b><font color="#0433ff">因为，如果频繁的多次判断是做无用功，因此我们可以建立一个位域变量，然后重载setDelegate方法，在其设置值时对其能否响应做好判断</font></b>。具体可以参照 P99页。</li><ul><li>位域变量示例：</li><li><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-variant-ligatures: normal; orphans: 2; text-indent: 28px; widows: 2; background-color: rgb(128, 160, 140);">typedef </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-variant-ligatures: normal; orphans: 2; text-indent: 28px; widows: 2; background-color: rgb(128, 160, 140);">struct </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-variant-ligatures: normal; orphans: 2; text-indent: 28px; widows: 2; background-color: rgb(128, 160, 140);"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-variant-ligatures: normal; orphans: 2; text-indent: 28px; widows: 2; background-color: rgb(128, 160, 140);">AA</span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; orphans: 2; text-indent: 28px; widows: 2; background-color: rgb(128, 160, 140);">{</span></li><div><div><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">unsigned </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">int </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">b1:1;</span></div><div><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">unsigned </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">int </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">b2:1;</span></div><div><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">unsigned </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">int </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">b3:1;</span></div><div><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">unsigned </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">int </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">b4:1;</span></div><div><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;"> </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">unsigned </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">int </span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(128, 160, 140); float: none;">b5:1;</span><span style="color: rgb(70, 70, 70); font-family: simsun; font-size: 14px; orphans: 2; text-indent: 28px; widows: 2; background-color: rgb(128, 160, 140);">}AA;</span></div></div></ul>
<li>类的<b>分类有两种</b>：

</li><ul>
<li>class-continuations ： 这是一个特殊的分类，它只能声明在主类的实现文件中。而且扩展名为()。它的三大功能：

</li><ul>
<li><b>这个分类可以生成实例变量，因此可以直接声明属性变量和实例变量</b>，其效果等同于直接在@implement中声明。私有属性和变量可以放在此处。</li>
<li>私有协议也可以放在此处。</li>
<li>如果一个属性在.h中为readonly，那么在此处它可以再次被扩展为readwrite。（注意任何分类出现的属性都应该与同类接口中的属性保持相同的特质，但是仅有readonly可以被扩展为readwrite）</li>
</ul>
<li>普通分类：有单独的头文件和实现文件，文件名通常为  className+扩展名 ,且@interface 需要指明扩展名。在<b>这些分类中不能生成实例变量</b>。（可以声明属性，但我们需要添加@dynamic，然后自己实现它的属性方法，并使用 关联对象为其设置实例变量）</li>
</ul>
<li>使用普通分类时，我们需要引入头文件才能使用里面的方法。</li>
<li>分类在编译时，是<b>按照载入顺序依次编译的</b>（载入顺序没有规律）。因此，如果两个分类中存在同名的扩展方法，那么<b>后载入的方法将覆盖前面载入的方法的具体实现</b>。因此，在编写分类时，最好在方法名前面加上分类的扩展名，比如 -（void)abc_urlEncoding; .</li>
<li>.mm表示将文件按照objective-C++来编译，如果我们引入的头文件或者是自身代码中包含了C++的语法，比如#include”” 或者是 class 等，我们就需要将实现文件改为.mm。且所有包含了此类头文件的实现文件都需要改为.mm。因此，我们建议在.h中最好不要有任何关于C++的写法。将其写在 class-continuations中，这样，我们就可以暴露一个完全OC的头文件，也不用强迫别人因为使用了我们的头文件而需要将实现文件的后缀改为.mm。</li>
<li>使用匿名对象 id&lt;protocolName&gt;，可以是值的类型多样化。<b>匿名类型不仅可以用在返回参数上，还可以用在调用参数上</b>。如果不符合协议要求，那么将在<b>编译阶段给出警告</b>。</li>
<li>id类型的指针可以指向任何类型的对象，而且像id类型的对象发送一则编译器已知的消息（可以是任何类的，只要是已知的即可），都不会引起编译警告，但可能引起crash，建议先使用 -(BOOL)respondsToSelector:(SEL) 判断是否存在。</li>
<li>在NSDictionary中，键的标准内存管理语意是 设置时copy，而值的内存管理语义是 设置时保留。因此，key的对象必须遵循NSCopying协议。因此，我们可以看到函数： -(void)setObject:(id)object forKey(id&lt;NSCopying&gt;)key;</li>
</ul><div><br></div></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/KSCrash简介【作者版】/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/KSCrash简介【作者版】/" itemprop="url">
                  KSCrash简介【作者版】
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T12:26:03+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/KSCrash简介【作者版】/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/KSCrash简介【作者版】/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="崩溃相关"><meta name="created" content="2016-12-04 13:39:42 +0000"><meta name="source" content="web.clip"><meta name="source-url" content="https://github.com/kstenerud/KSCrash"><meta name="updated" content="2016-12-30 06:11:44 +0000"><title>KSCrash简介【作者版】</title></head><body><div style="-evernote-webclip:true"><br><div style="display: inline-block;"><div style="box-sizing: border-box;"><div style="box-sizing: border-box; background-color: rgb(255, 255, 255); word-wrap: break-word;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;border-radius:3px;"><div style="box-sizing: border-box; word-wrap: break-word; background-color: rgb(255, 255, 255); border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><div style="box-sizing: border-box; margin: 0px 0px 16px; font-size: 32px; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight: 600;"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">KSCrash</font></font></span></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 20px; font-weight: 600;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><font color="#333333">KSCrash功能简介：</font></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">以下是KSCrash的一些主要特点：</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0.25em;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><b><span style="color: rgb(51, 51, 51);">崩溃记录相关：</span></b></span><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">跟踪未捕获的C ++异常的真正原因。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">处理只能在Mach级被捕获的错误，如堆栈溢出。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">处理在KSCrash本身（或在用户崩溃处理程序回调）的崩溃。</span></span></li></ul></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><b>崩溃上报相关</b>：</span></span></li></ul></div><ul style="box-sizing:border-box;padding-left:2em;margin-top:0px;margin-bottom:16px;"><li style="display:inline;list-style:none;"><ul><li style="box-sizing:border-box;margin-top:0.25em;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">生成完整的苹果格式的报告，但有很多额外信息无法上报。</span></span></li><li style="box-sizing:border-box;margin-top:0.25em;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">记录大量额外的信息，使用JSON格式上报。</font></font></span></span></li><li style="box-sizing:border-box;margin-top:0.25em;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">它的可插拔的服务器报告架构可以很容易地适应任何API服务。</span></span></li><li style="box-sizing:border-box;margin-top:0.25em;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">提供用户可操作接口，用于提供额外的数据上报（在崩溃发生之前和崩溃中执行）。</font></font></span></span></li></ul></li></ul><div style="box-sizing:border-box;margin-top:0.25em;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><font color="#333333"><b>额外功能</b>：</font></span><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">支持32位和64位模式。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">记录僵尸（释放的）对象，并在需要的时候访问尝试它。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">恢复在僵尸对象或内存操作中被释放的NSException消息。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">On-device symbolication 在某种情况下支持离线re-symbolication（必要的IOS版本有许多功能已被删节）。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">在寄存器和堆栈上的自省对象（C String和Objective-C Object，包括变量）。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">提取额外的对象信息给exception参考（such as "unrecognized selector sent to instance 0xa26d9a0"等）</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">转储堆栈内容。</span></span></li><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">诊断崩溃原因（Crash Doctor）。</span></span></li></ul></li></ul></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">KSCrash可以处理以下类型的崩溃：</font></font></span></span></div></div><ul style="box-sizing:border-box;padding-left:2em;margin-top:0px;margin-bottom:16px;"><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Mach kernel exceptions</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Fatal signals</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">C++ exceptions</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Objective-C exceptions</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Main thread deadlock (实验性质)</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Custom crashes (e.g. from scripting languages)</span></span></li></ul><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">KSCrash支持发送以下服务器的报告：</font></font></span></span></div></div><ul style="box-sizing:border-box;padding-left:2em;margin-top:0px;margin-bottom:16px;"><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Hockey</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">QuincyKit</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Victory</span></span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">Email</span></span></li></ul><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><font style="box-sizing: border-box; background-color: transparent; text-decoration: none;"><font style="box-sizing:border-box;">报告格式示例：<a href="https://github.com/kstenerud/KSCrash/tree/master/Example-Reports/_README.md" style="box-sizing:border-box;background-color:transparent;color:rgb(64, 120, 192);text-decoration:none;" target="_blank" rel="external">下面是它可以生成报告的一些例子。</a></font></font></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 20px; font-weight: 600;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">新特性简介：</font></font></span></span></div></div><h4 style="box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:1em;font-weight:600;"><a href="https://github.com/kstenerud/KSCrash#c-exception-handling" style="box-sizing:border-box;background-color:transparent;color:rgb(64, 120, 192);text-decoration:none;float:left;padding-right:4px;margin-left:-20px;" target="_blank" rel="external"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">C ++异常处理</font></font></span></span></a></h4><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">一般来说，如果您的应用程序终止由于未捕获的C ++异常，你得到的是这样的：</font></font></span></span></div></div><div style="font-weight:normal;font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;font-stretch:normal;font-variant:normal;font-style:normal;margin-bottom:16px;font-size:85%;margin-top:0px;padding:16px;overflow:auto;background-color:rgb(247, 247, 247);border-radius:3px;"><span style="color: rgb(51, 51, 51);"><code style="font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;border:0px;padding:0px;border-radius:3px;font-size:100%;background:transparent;margin:0px;display:inline;overflow:visible;background-color:transparent;"><span style="font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size:100%;letter-spacing:-0.2em;">normal</span>Thread&nbsp;&nbsp;0&nbsp;&nbsp;name:&nbsp;&nbsp; Dispatch&nbsp;&nbsp;queue:&nbsp;&nbsp;com.apple.main-thread<br>
Thread&nbsp;&nbsp;0&nbsp;&nbsp;Crashed:<br>
0&nbsp;&nbsp;&nbsp;&nbsp;libsystem_kernel.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x9750ea6a&nbsp;&nbsp;0x974fa000&nbsp;&nbsp;+&nbsp;&nbsp;84586&nbsp;&nbsp;(__pthread_kill&nbsp;&nbsp;+&nbsp;&nbsp;10) <br>
1&nbsp;&nbsp;&nbsp;&nbsp;libsystem_sim_c.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x04d56578&nbsp;&nbsp;0x4d0f000&nbsp;&nbsp;+&nbsp;&nbsp;292216&nbsp;&nbsp;(abort&nbsp;&nbsp;+&nbsp;&nbsp;137) <br>
2&nbsp;&nbsp;&nbsp;&nbsp;libc++abi.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x04ed6f78&nbsp;&nbsp;0x4ed4000&nbsp;&nbsp;+&nbsp;&nbsp;12152&nbsp;&nbsp;(abort_message&nbsp;&nbsp;+&nbsp;&nbsp;102) <br>
3&nbsp;&nbsp;&nbsp;&nbsp;libc++abi.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x04ed4a20&nbsp;&nbsp;0x4ed4000&nbsp;&nbsp;+&nbsp;&nbsp;2592&nbsp;&nbsp;(_ZL17default_terminatev&nbsp;&nbsp;+&nbsp;&nbsp;29) <br>
4&nbsp;&nbsp;&nbsp;&nbsp;libobjc.A.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x013110d0&nbsp;&nbsp;0x130b000&nbsp;&nbsp;+&nbsp;&nbsp;24784&nbsp;&nbsp;(_ZL15_objc_terminatev&nbsp;&nbsp;+&nbsp;&nbsp;109) <br>
5&nbsp;&nbsp;&nbsp;&nbsp;libc++abi.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x04ed4a60&nbsp;&nbsp;0x4ed4000&nbsp;&nbsp;+&nbsp;&nbsp;2656&nbsp;&nbsp;(_ZL19safe_handler_callerPFvvE&nbsp;&nbsp;+&nbsp;&nbsp;8) <br>
6&nbsp;&nbsp;&nbsp;&nbsp;libc++abi.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x04ed4ac8&nbsp;&nbsp;0x4ed4000&nbsp;&nbsp;+&nbsp;&nbsp;2760&nbsp;&nbsp;(_ZSt9terminatev&nbsp;&nbsp;+&nbsp;&nbsp;18) <br>
7&nbsp;&nbsp;&nbsp;&nbsp;libc++abi.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x04ed5c48&nbsp;&nbsp;0x4ed4000&nbsp;&nbsp;+&nbsp;&nbsp;7240&nbsp;&nbsp;(__cxa_rethrow&nbsp;&nbsp;+&nbsp;&nbsp;77) <br>
8&nbsp;&nbsp;&nbsp;&nbsp;libobjc.A.dylib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x01310fb8&nbsp;&nbsp;0x130b000&nbsp;&nbsp;+&nbsp;&nbsp;24504&nbsp;&nbsp;(objc_exception_rethrow&nbsp;&nbsp;+&nbsp;&nbsp;42) <br>
9&nbsp;&nbsp;&nbsp;&nbsp;CoreFoundation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x01f2af98&nbsp;&nbsp;0x1ef9000&nbsp;&nbsp;+&nbsp;&nbsp;204696&nbsp;&nbsp;(CFRunLoopRunSpecific&nbsp;&nbsp;+&nbsp;&nbsp;360) </code></span><div><span style="color: rgb(51, 51, 51);"><span style="background-color: transparent;"><span style="font-size: 100%;">...</span></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">没办法追踪这个exception是什么或者它是从哪里抛出的。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">现在有了KSCrash，你将得到捕获的异常类型，描述，以及它抛出的位置：</font></font></span></span></div></div><div style="font-weight:normal;font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;font-stretch:normal;font-variant:normal;font-style:normal;margin-bottom:16px;font-size:85%;margin-top:0px;padding:16px;overflow:auto;background-color:rgb(247, 247, 247);border-radius:3px;"><span style="color: rgb(51, 51, 51);"><code style="font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;border:0px;padding:0px;border-radius:3px;font-size:100%;background:transparent;margin:0px;display:inline;overflow:visible;background-color:transparent;"><span style="font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size:100%;letter-spacing:-0.2em;">normal</span>Application&nbsp;&nbsp;Specific&nbsp;&nbsp;Information:<br>
***&nbsp;&nbsp;Terminating&nbsp;&nbsp;app&nbsp;&nbsp;due&nbsp;&nbsp;to&nbsp;&nbsp;uncaught&nbsp;&nbsp;exception&nbsp;&nbsp;'MyException',&nbsp;&nbsp;reason:&nbsp;&nbsp;'Something&nbsp;&nbsp;bad&nbsp;&nbsp;happened...'<br><br>
Thread&nbsp;&nbsp;0&nbsp;&nbsp;name:&nbsp;&nbsp; Dispatch&nbsp;&nbsp;queue:&nbsp;&nbsp;com.apple.main-thread<br>
Thread&nbsp;&nbsp;0&nbsp;&nbsp;Crashed:<br>
0&nbsp;&nbsp;&nbsp;&nbsp;Crash-Tester&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x0000ad80&nbsp;&nbsp;0x1000&nbsp;&nbsp;+&nbsp;&nbsp;40320&nbsp;&nbsp;(-[Crasher&nbsp;&nbsp;throwUncaughtCPPException]&nbsp;&nbsp;+&nbsp;&nbsp;0) <br>
1&nbsp;&nbsp;&nbsp;&nbsp;Crash-Tester&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x0000842e&nbsp;&nbsp;0x1000&nbsp;&nbsp;+&nbsp;&nbsp;29742&nbsp;&nbsp;(__32-[AppDelegate(UI)&nbsp;&nbsp;crashCommands]_block_invoke343&nbsp;&nbsp;+&nbsp;&nbsp;78) <br>
2&nbsp;&nbsp;&nbsp;&nbsp;Crash-Tester&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x00009523&nbsp;&nbsp;0x1000&nbsp;&nbsp;+&nbsp;&nbsp;34083&nbsp;&nbsp;(-[CommandEntry&nbsp;&nbsp;executeWithViewController:]&nbsp;&nbsp;+&nbsp;&nbsp;67) <br>
3&nbsp;&nbsp;&nbsp;&nbsp;Crash-Tester&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x00009c0a&nbsp;&nbsp;0x1000&nbsp;&nbsp;+&nbsp;&nbsp;35850&nbsp;&nbsp;(-[CommandTVC&nbsp;&nbsp;tableView:didSelectRowAtIndexPath:]&nbsp;&nbsp;+&nbsp;&nbsp;154) <br>
4&nbsp;&nbsp;&nbsp;&nbsp;UIKit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0016f285&nbsp;&nbsp;0xb4000&nbsp;&nbsp;+&nbsp;&nbsp;766597&nbsp;&nbsp;(-[UITableView&nbsp;&nbsp;_selectRowAtIndexPath:animated:scrollPosition:notifyDelegate:]&nbsp;&nbsp;+&nbsp;&nbsp;1194) <br>
5&nbsp;&nbsp;&nbsp;&nbsp;UIKit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0016f4ed&nbsp;&nbsp;0xb4000&nbsp;&nbsp;+&nbsp;&nbsp;767213&nbsp;&nbsp;(-[UITableView&nbsp;&nbsp;_userSelectRowAtPendingSelectionIndexPath:]&nbsp;&nbsp;+&nbsp;&nbsp;201) <br>
6&nbsp;&nbsp;&nbsp;&nbsp;Foundation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x00b795b3&nbsp;&nbsp;0xb6e000&nbsp;&nbsp;+&nbsp;&nbsp;46515&nbsp;&nbsp;(__NSFireDelayedPerform&nbsp;&nbsp;+&nbsp;&nbsp;380) <br>
7&nbsp;&nbsp;&nbsp;&nbsp;CoreFoundation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x01f45376&nbsp;&nbsp;0x1efa000&nbsp;&nbsp;+&nbsp;&nbsp;308086&nbsp;&nbsp;(__CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__&nbsp;&nbsp;+&nbsp;&nbsp;22) <br>
8&nbsp;&nbsp;&nbsp;&nbsp;CoreFoundation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x01f44e06&nbsp;&nbsp;0x1efa000&nbsp;&nbsp;+&nbsp;&nbsp;306694&nbsp;&nbsp;(__CFRunLoopDoTimer&nbsp;&nbsp;+&nbsp;&nbsp;534) <br>
9&nbsp;&nbsp;&nbsp;&nbsp;CoreFoundation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x01f2ca82&nbsp;&nbsp;0x1efa000&nbsp;&nbsp;+&nbsp;&nbsp;207490&nbsp;&nbsp;(__CFRunLoopRun&nbsp;&nbsp;+&nbsp;&nbsp;1810) <br>
10&nbsp;&nbsp; CoreFoundation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x01f2bf44&nbsp;&nbsp;0x1efa000&nbsp;&nbsp;+&nbsp;&nbsp;204612&nbsp;&nbsp;(CFRunLoopRunSpecific&nbsp;&nbsp;+&nbsp;&nbsp;276) </code></span><div><span style="color: rgb(51, 51, 51);"><span style="background-color: transparent;"><span style="font-size: 100%;">...</span></span></span></div></div><h4 style="box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:1em;font-weight:600;"><a href="https://github.com/kstenerud/KSCrash#handy-c-development-helper" style="box-sizing:border-box;background-color:transparent;color:rgb(64, 120, 192);text-decoration:none;float:left;padding-right:4px;margin-left:-20px;" target="_blank" rel="external"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">方便的C ++开发帮手</font></font></span></span></a></h4><p style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">如果您打开跟踪打印：</font></font></span></span></p><div style="box-sizing:border-box;margin-bottom:16px;"><pre style="font-stretch:normal;font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;font-weight:normal;font-variant:normal;font-style:normal;margin-top:0px;word-wrap:normal;margin-bottom:0px;font-size:85%;word-break:normal;padding:16px;overflow:auto;background-color:rgb(247, 247, 247);border-radius:3px;"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">[KSCrash </font></font></span><span style="box-sizing:border-box;color:rgb(0, 134, 179);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">sharedInstance</font></font></span><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;"> ] .printTraceToStdout = </font></font></span><span style="box-sizing:border-box;color:rgb(0, 134, 179);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">YES</font></font></span><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;"> ;</font></font></span></pre></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">它会打印正确的堆栈跟踪到标准输出，只要你的应用程序抛出一个未捕获C ++异常！</font><font style="box-sizing:border-box;">否则，调试器只会导致你在异常被重新抛出。</font></font></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">自定义崩溃和堆栈跟踪</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">现在，您可以自己定制的崩溃和堆栈跟踪（例如对于脚本语言的崩溃）：</font></font></span></span></div></div><div style="box-sizing:border-box;margin-bottom:16px;"><div style="font-stretch:normal;font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;font-weight:normal;font-variant:normal;font-style:normal;margin-top:0px;margin-bottom:0px;font-size:85%;padding:16px;overflow:auto;background-color:rgb(247, 247, 247);border-radius:3px;"><div>- (void) reportUserException:(NSString*) name</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reason:(NSString*) reason </div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lineOfCode:(NSString*) lineOfCode </div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stackTrace:(NSArray*) stackTrace </div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; terminateProgram:(BOOL) terminateProgram; </div></div></div><p style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">见KSCrash.h了解详情。</font></font></span></span></p><h3 style="box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:1.25em;font-weight:600;"><a href="https://github.com/kstenerud/KSCrash#unstable-features" style="box-sizing:border-box;background-color:transparent;color:rgb(64, 120, 192);text-decoration:none;float:left;padding-right:4px;margin-left:-20px;" target="_blank" rel="external"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">不稳定的特点</font></font></span></span></a></h3><p style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">以下功能应被视为“不稳定”，默认情况下被禁用：</font></font></span></span></p><ul style="box-sizing:border-box;padding-left:2em;margin-top:0px;margin-bottom:16px;"><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">死锁检测</font></font></span></span></li></ul><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 24px; font-weight: 600; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">如何导入KSCrash</font></font></span></span></div></div><ol style="box-sizing:border-box;padding-left:2em;margin-top:0px;margin-bottom:16px;"><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">打开ios.workspace。</font></font></span></span></li><li style="box-sizing:border-box;margin-top:0.25em;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">选择KSCrash Scheme。</font></font></span></span></li><li style="box-sizing:border-box;margin-top:0.25em;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">Build或者Archiver项目。</font></font></span></span></li></ol><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">然后，你像使用任何其他框架一样使用它。</font></font></span></span></div></div><h2 style="box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:1.5em;font-weight:600;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);"><a href="https://github.com/kstenerud/KSCrash#how-to-use-kscrash" style="box-sizing:border-box;background-color:transparent;color:rgb(64, 120, 192);text-decoration:none;float:left;padding-right:4px;margin-left:-20px;" target="_blank" rel="external"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">如何使用KSCrash</font></font></span></span></a></h2><ul><li style="box-sizing:border-box;"><div style="box-sizing:border-box;margin-bottom:16px;margin-top:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">将该框架添加到项目中（或添加KSCrash项目作为依赖）</font></font></span></span><br><br></div></li><li style="box-sizing:border-box;margin-top:0.25em;"><p style="box-sizing:border-box;margin-bottom:16px;margin-top:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">下面的系统框架和库添加到您的项目：</font></font></span></span></p><ul style="box-sizing:border-box;padding-left:2em;margin-top:0px;margin-bottom:0px;"><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">libc++.dylib</span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">libz.dylib</span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">MessageUI.framework&nbsp;&nbsp;</span><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">【iOS only】</span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">SystemConfiguration.framework</span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">Foundation.framework</span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">CoreGraphics.framework</span></li><li style="box-sizing:border-box;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">UIKit.framework【iOS only】</span></li></ul></li><li style="box-sizing:border-box;margin-top:0.25em;"><div style="box-sizing:border-box;margin-bottom:16px;margin-top:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">添加 "<b>-ObjC</b>" 标示到&nbsp;&nbsp; <b>Build Setting - Other Linker Flags</b> 中.【加载分类数据】</span></div></li><li style="box-sizing:border-box;margin-top:0.25em;"><div style="box-sizing:border-box;margin-bottom:16px;margin-top:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);">【可选】如果希望自己定制化KSCrash内容，那么可以将以下内容添加到你的[application：didFinishLaunchingWithOptions：] 方法中：</span></span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KSCrash *ksCrash = [KSCrash sharedInstance];</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ksCrash.catchZombies = YES;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ksCrash.introspectMemory = YES;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ksCrash install];</span></span></div></div><div style="box-sizing:border-box;margin-bottom:16px;margin-top:16px;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">&nbsp;&nbsp;【可选】如果希望使用KSCrash的上报服务器，那么可以将以下内容添加到你的</font></font><strong style="box-sizing:border-box;font-weight:600;"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">[application：didFinishLaunchingWithOptions：]</font></font></strong> <font style="box-sizing:border-box;"><font style="box-sizing:border-box;">方法中：【如果希望定制化KSCrash的属性，那么应该通过修改源码实现】</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-bottom:16px;"><div style="font-stretch:normal;font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;font-weight:normal;font-variant:normal;font-style:normal;margin-top:0px;margin-bottom:0px;font-size:85%;padding:16px;overflow:auto;background-color:rgb(247, 247, 247);border-radius:3px;"><div>#import &lt;KSCrash/KSCrash.h&gt;</div><div>// Include to use the standard reporter.</div><div>#import &lt;KSCrash/KSCrashInstallationStandard.h&gt;</div><div>// Include to use Quincy or Hockey.</div><div>#import &lt;KSCrash/KSCrashInstallationQuincyHockey.h&gt;</div><div>// Include to use the email reporter.</div><div>#import &lt;KSCrash/KSCrashInstallationEmail.h&gt;</div><div>// Include to use Victory.</div><div>#import &lt;KSCrash/KSCrashInstallationVictory.h&gt;</div><div><br></div><div>- (BOOL)application:(UIApplication*) application didFinishLaunchingWithOptions:(NSDictionary*) launchOptions</div><div>{</div><div>KSCrashInstallationStandard* installation = [KSCrashInstallationStandard sharedInstance];</div><div>installation.url = [NSURL URLWithString:@"http://put.your.url.here"];</div><div><br></div><div>// OR:</div><div><br></div><div>KSCrashInstallationQuincy* installation = [KSCrashInstallationQuincy sharedInstance];</div><div>installation.url = [NSURL URLWithString:@"http://put.your.url.here"];</div><div><br></div><div>// OR:</div><div><br></div><div>KSCrashInstallationHockey* installation = [KSCrashInstallationHockey sharedInstance];</div><div>installation.appIdentifier = @"PUT_YOUR_HOCKEY_APP_ID_HERE";</div><div><br></div><div>// OR:</div><div><br></div><div>KSCrashInstallationEmail* installation = [KSCrashInstallationEmail sharedInstance];</div><div>installation.recipients = @[@"some@email.address"];</div><div><br></div><div>// Optional (Email): Send Apple-style reports instead of JSON</div><div>[installation setReportStyle:KSCrashEmailReportStyleApple useDefaultFilenameFormat:YES];</div><div><br></div><div>// Optional: Add an alert confirmation (recommended for email installation)</div><div>[installation addConditionalAlertWithTitle:@"Crash Detected"</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message:@"The app crashed last time it was launched. Send a crash report?" </div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yesAnswer:@"Sure!" </div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noAnswer:@"No thanks"]; </div><div><br></div><div>// OR:</div><div><br></div><div>KSCrashInstallationVictory* installation = [KSCrashInstallationVictory sharedInstance];</div><div>installation.url = [NSURL URLWithString:@"https://put.your.url.here/api/v1/crash/&lt;application key&gt;"];</div><div><br></div><div>[installation install];</div><div>&nbsp;&nbsp;&nbsp;&nbsp; … </div><div>}</div></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">以上操作，将安装崩溃监视系统（拦截崩溃并存储报告到磁盘）。</font><font style="box-sizing:border-box;">请注意，有可能要为具体的设备设置其他属性。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">【可选】如果你使用KSCrashInstallation安装KSCrash，一旦你准备好发送任务，那么可以调用以下方法发送崩溃数据：</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-bottom:16px;"><div style="font-stretch:normal;font-family:Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;box-sizing:border-box;font-weight:normal;font-variant:normal;font-style:normal;margin-top:0px;margin-bottom:0px;font-size:85%;padding:16px;overflow:auto;background-color:rgb(247, 247, 247);border-radius:3px;"><div>[installation sendAllReportsWithCompletion:^(NSArray *filteredReports, BOOL completed, NSError *error)</div><div>{</div><div>&nbsp;&nbsp;// Stuff to do when report sending is complete</div><div>}];</div></div></div><h2 style="box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:1.5em;font-weight:600;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);"><a href="https://github.com/kstenerud/KSCrash#recommended-reading" style="box-sizing:border-box;background-color:transparent;color:rgb(64, 120, 192);text-decoration:none;float:left;padding-right:4px;margin-left:-20px;" target="_blank" rel="external"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">推荐阅读</font></font></span></span></a></h2><p style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">如果可能的话，你应该阅读下面的头文件，充分了解哪些功能KSCrash了，以及如何使用它们：</font></font></span></span></p><ul style="box-sizing:border-box;padding-left:2em;margin-top:0px;margin-bottom:16px;"><li style="box-sizing:border-box;">KSCrash.h</li><li style="box-sizing:border-box;">KSCrashInstallation.h</li><li style="box-sizing:border-box;">KSCrashInstallation(SPECIFIC TYPE).h</li><li style="box-sizing:border-box;">Architecture.md</li></ul><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"><div><span style="font-weight: 600;"><span style="font-size: 20px;"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">高级用法</font></font></span></span></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 16px; font-weight: 600;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">启用On-Device symbolication</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">On-device symbolication需要基本符号存在于最终程序中。</font><font style="box-sizing:border-box;">为了实现这一目标，我们需要设置 <b>Build Setting - Strip Style</b> 为 <b>Debugging Symbol</b></font></font><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">。如果</font><font style="box-sizing:border-box;">这样做将会使你的最终二进制文件大小增加约5％，，但你将获得On-device symbolication的能力。</font></font></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 16px; font-weight: 600;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">启用高级功能：</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">KSCrash拥有先进的功能，对于研究用户上报的崩溃报告时会非常有用。</font><font style="box-sizing:border-box;">一些功能涉及到取舍，所以大部分都是默认禁用。</font></font></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">自定义用户数据（userInfo in KSCrash.h）</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">您可以</font></font></span></span><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">通过操作KSCrash的 userInfo 属性</font></font></span></span>&nbsp;&nbsp;，<span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">设置自定义的用户数据到下一个崩溃报告中</font></font><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">。</font></font></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">僵尸跟踪（zombieCacheSize in KSCrash.h）</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">KSCrash具有检测僵尸实例（指向已释放的对象的野指针）的能力。</font><font style="box-sizing:border-box;">它通过记录被释放的任何对象的 Address 和 Class 做到这一点。</font><font style="box-sizing:border-box;">它在高速缓存中存储这些值，key是被释放对象的Address，value是被释放对象的Class。同时这个高速缓存的大小可以由你设置，但是缓存越小，就意味着越有可能发生散列碰撞，这将导致你失去先前已存储的释放对象的内容</font><font style="box-sizing:border-box;">。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">当僵尸跟踪启用时，KSCrash还将记录最后一个NSException的内容并放到崩溃报告中。</font><font style="box-sizing:border-box;">某些种类的内存损坏或堆栈损的坏崩溃会导致NSException被提前释放，这个功能可以提供关于元凶的真实信息，所以这个功能有时可能很方便。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;"><u><b>权衡</b>：跟踪僵尸会在对象dealloc时增加非常轻微的开销，以及有一些内存占用</u>。</font></font></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">死锁检测（deadlockWatchdogInterval in KSCrash.h）</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><strong style="box-sizing:border-box;font-weight:600;"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">警告警告警告警告警告警告警告</font></font></strong></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><strong style="box-sizing:border-box;font-weight:600;"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">此功能是不稳定的！</font><font style="box-sizing:border-box;">它可能会错误判定并且主动使您的应用程序崩溃！</font></font></strong></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">如果你的主线程死锁，您的用户界面会变得反应迟钝，用户必须手动关闭应用程序（对此不会有崩溃报告）。</font><font style="box-sizing:border-box;">随着死锁检测启用，为看门狗定时器设置一个时间阈值，</font><font style="box-sizing:border-box;">如果有任何函数在主线程上的持续时间超过看门狗定时器的阈值，KSCrash将主动关闭应用程序，并且为主线程生成一个堆栈跟踪。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">这是美好的，但你必须小心：特别是应用程序初始化一般发生在主线程，</font><font style="box-sizing:border-box;">如果你的初始化代码比看门狗定时器需要更长的时间，你的应用程序将被强制在启动时关机！</font><font style="box-sizing:border-box;">如果启用此功能，您必须确保您正常运行的代码，无持有主线程比看门狗的阈值长！</font><font style="box-sizing:border-box;">同时，你要定时器设置为一个足够低的值，赶在用户没有变得不耐烦之前触发看门狗触发手动关闭应用程序！</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><u><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;"><b>权衡</b>：死锁检测，但你一定要多多小心什么主线程上运行！</font></font></span></span></u></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">内存内省（introspectMemory in KSCrash.h）</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">当一个应用程序崩溃，通常在堆栈、寄存器甚至异常消息中会有一些对象和字符串的引用。</font><font style="box-sizing:border-box;">启用内存内省后，KSCrash将会去尝试读取这些内存地址上的内容【Type、Value、ivars、Address、last_dealloc_obj等信息】，并将其记录到报告中。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">我们可以将不需要内省的类设置到KSCrash.</font></font><span style="box-sizing: border-box;"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;"><span style="font-weight: 600;">doNotIntrospectClasses</span>&nbsp;&nbsp;属性【列表】中</font></font></span><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">。记录后，这些类的对象将只记录class name。</font></font></span></span></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">自定义崩溃处理代码（onCrash in KSCrash.h）</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">如果你想要在崩溃发生后做一些额外的处理（也许是为了增加更多的上下文数据报告），你可以设置这个属性，它是一个函数指针【非block】。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">但是，你必须确保你只使用异步安全的代码，并且确保不在这一段代码中调用OC代码【C和C++还是可以的】！虽然在</font><font style="box-sizing:border-box;">很多情况下，你可以不必这样做，但在某些类别的崩溃中，编写不符合上述规定的程序代码会导致崩溃处理block崩溃！</font><font style="box-sizing:border-box;">请注意，如果发生这种情况，KSCrash会检测到它，继续写一个完整的报告，尽管自定义处理程序代码可能没有完全运行。</font></font></span></span></div></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><u><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;"><b>权衡</b>：自定义崩溃处理代码，但是你必须要小心的编写它！</font></font></span></span></u></div></div><div style="box-sizing: border-box; margin-top: 24px; margin-bottom: 16px; font-size: 1em; font-weight: 600;"><ul><li><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">KSCrash日志重定向</font></font></span></span></li></ul></div><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">这会将所有的KSCrash的输出被打印到控制台，或者将其写入一个文件来代替。</font><font style="box-sizing:border-box;">主要是用这个来调试KSCrash本身，而是它可能还有其他用途，所以我开放它的API。</font></font></span></span></div></div><h2 style="box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:1.5em;font-weight:600;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);"><a href="https://github.com/kstenerud/KSCrash#examples" style="box-sizing:border-box;background-color:transparent;color:rgb(64, 120, 192);text-decoration:none;float:left;padding-right:4px;margin-left:-20px;" target="_blank" rel="external"><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">示例</font></font></span></span></a></h2><div style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;"><div><span style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="color: rgb(51, 51, 51);"><font style="box-sizing:border-box;"><font style="box-sizing:border-box;">工作区包括一些示例应用程序，这表明普通KSCrash用法。</font><font style="box-sizing:border-box;">请看看AppDelegate.m在每个应用程序的顶部是做什么的说明。</font></font></span></span></div></div></div></div></div></div></div></div></div></div></div></div><br></div><div><br></div></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/08/iOS断言机制/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/iOS断言机制/" itemprop="url">
                  iOS断言机制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-08T12:26:03+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/iOS断言机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/iOS断言机制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="altitude" content="14.96459484100342"><meta name="author" content="程剑锋"><meta name="created" content="2016-12-18 05:56:02 +0000"><meta name="latitude" content="31.21637165561905"><meta name="longitude" content="121.3023501081429"><meta name="source" content="desktop.mac"><meta name="updated" content="2016-12-19 07:15:15 +0000"><title>iOS断言机制</title></head><body><div><br></div><div><b>断言推荐使用的场景</b>：</div><div><ul><li>用错误处理代码来处理预期会发生的情况,用<b><font color="#0433FF">断言来处理绝不该发生的状况</font></b>.<br></li><li><b><font color="#0433FF">避免把需要执行的代码放到断言中</font></b>.因为断言在Debug模式下是生效的,但在Release模式在无效,这样就会丢失执行代码.<br></li><li>用断言来注释并验证前条件和后条件.<br></li><li>对于高健壮的代码,应先使用断言,再处理错误.<br></li></ul></div><div><br></div><div><br></div><div><b>Xcode上断言生效的设置</b>：</div><div><ul><li>Debug默认生效，Release模式下默认失效。</li></ul><div><img src="/Resources/iOS%E6%96%AD%E8%A8%80%E6%9C%BA%E5%88%B6.resources/18B32226-0F22-40A7-97A2-294D929E4C82.png" height="188" width="677"><br></div></div><div><br></div><div><br></div><div><b>断言常用宏</b>：</div><div><ul><li><b>NSAssert</b>( condition, description , …__vars__... )：<b>OC断言宏</b>，断言条件不成立时，打印信息并抛出异常【异常无人处理时将退出程序】。<b>只适用于OC函数内部断言</b>。
</li><ul><li>decription是输出表达式，__vars__是表达式中用到的变量参数。<br></li><li>有多参数版本，其实就是根据有多少个 __vars__ 然后取不同名字的Assert版本，比如NSAssert1，NSAssert2，NSAssert3，NSAssert4和NSAssert5。【但其实直接用原版本即可】</li></ul><li><b>NSCAssert</b>( condition, description , …__vars__... )：<b>C断言宏</b>，使用于<b>C函数和OC函数内部只能使用此断言</b>。【在C函数中只能使用<font style="font-weight: bold;">NSCAssert</font>】<br></li><ul><li>它与NSAssert的代码区别在于，取函数名时，NSAssert用的是__cmd,而NSCAssert用的是__PRETTY_FUNCTION__。然后NSAssertionHandler调用的抛出函数也不同。</li><li>也有多参数版本。</li></ul><li><b>NSParameterAssert</b>( condition )：<br></li><ul><li>定义：#define NSParameterAssert(condition) NSAssert((condition), @"Invalid parameter not satisfying: %@", @#condition)</li><li>作用：失败时自动输出条件判断语句，相当于NSAssert的一层格式化封装。</li></ul><li><b>NSCParameterAssert</b>(condition):<br></li><ul><li>定义：#define NSCParameterAssert(condition) NSCAssert((condition), @"Invalid parameter not satisfying: %@", @#condition)</li><li>作用：失败时自动输出条件判断语句，相当于NSCAssert的一层格式化封装。<br></li></ul></ul><div><br></div></div><div><br></div><div><b>AssertHandler断言处理回调</b>：</div><ul><li><b>默认的断言处理回调</b>：当断言不成立时，<b>会向 NSAssertionHandler实例发送一个表示错误的字符串。每个线程都有它自己的NSAssertionHandler实例</b>。【断点无法停留在准确的代码行】
</li><ul><li>NSAeert调用：[[NSAssertionHandler currentHandler] handleFailureInMethod:_cmd object:self file:__assert_file__  lineNumber:__LINE__ description:(desc), ##__VA_ARGS__];告知断言失败。</li><li>NSCAeert调用：[[NSAssertionHandler currentHandler] handleFailureInFunction:__assert_fn__ object:self file:__assert_file__  lineNumber:__LINE__ description:(desc), ##__VA_ARGS__];告知断言失败。<br></li></ul><li><b>注册自定义的断言处理回调</b>：
</li><ul><li>继承<font style="font-weight: bold;">NSAssertionHandler</font>实现自己的断言处理类。</li><li>在继承类中重载上面提到的两个方法。</li><li>在需要使用自定义断言处理的线程上注册。</li></ul><li><b>自定义断言处理类示例</b>：</li></ul><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">@implementation CJFAssertionHandler</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br></span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//处理Objective-C的断言</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)handleFailureInMethod:(SEL)selector object:(id)object file:(NSString *)fileName lineNumber:(NSInteger)line description:(NSString *)format,...</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    NSLog(@"NSAssert Failure: Method %@ for object %@ in %@ ,line: %li", NSStringFromSelector(selector), object, fileName, (long)line);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><span>    //建议加上abort(),方便及时发现问题，且调用栈可观察。</span><br></span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><span><span>    abort();</span><br></span></span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//处理C的断言</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">- (void)handleFailureInFunction:(NSString *)functionName file:(NSString *)fileName lineNumber:(NSInteger)line description:(NSString *)format,...</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    NSLog(@"NSCAssert Failure: Function (%@) in %@ ,line: %li", functionName, fileName, (long)line);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><span>    <span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><span>//建议加上abort(),方便及时发现问题，且调用栈可观察。</span><br></span></span></span></span></span></span></span></div><div><div></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><span><span>    abort();</span></span></span></span></span><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><span><br></span></span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br></span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">@end</span></span></span></div></div><ul><li><b>自定义断言处理类注册</b>：</li></ul><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px;">CJFAssertionHandler *myHandler = [[CJFAssertionHandler alloc] init];</span><br></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//给当前的线程</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">[[[NSThread currentThread] threadDictionary] setValue:myHandler forKey:NSAssertionHandlerKey];</span></span></span></div></div><div><br></div><div><br></div><div><b>参考文章与示例</b>：<a href="http://www.jianshu.com/p/6e444981ab45" target="_blank" rel="external">http://www.jianshu.com/p/6e444981ab45</a></div><div><br></div></div></body></html>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/logo.jpg"
               alt="Cheng JianFeng" />
          <p class="site-author-name" itemprop="name">Cheng JianFeng</p>
          <p class="site-description motion-element" itemprop="description">iOS,Python,Unity</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">62</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/TreasureU" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://treasureu.github.io/" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://treasureu.github.io/" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://treasureu.github.io/" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  简书
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cheng JianFeng</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ChengJianFeng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js?v=5.1.0"></script>
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  










  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


</body>
</html>
