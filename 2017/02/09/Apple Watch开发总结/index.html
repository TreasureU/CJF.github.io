<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS," />





  <link rel="alternate" href="/atom.xml" title="Cheng JianFeng's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/logo.jpg?v=5.1.0" />






<meta name="description" content="Apple Watch开发总结基本概念：在watch中，我们目前可以选择基于 ios的代码运行机制（watchOS1.0），也可以选择基于 watchOS的运行机制（watchOS2.0）。这一点在 Build Setting - Architectures - Base SDK 中设置。Build Setting - Architectures - Architecture ,在debug">
<meta property="og:type" content="article">
<meta property="og:title" content="Apple Watch开发总结">
<meta property="og:url" content="https://treasureu.github.io/2017/02/09/Apple Watch开发总结/index.html">
<meta property="og:site_name" content="Cheng JianFeng's Blog">
<meta property="og:description" content="Apple Watch开发总结基本概念：在watch中，我们目前可以选择基于 ios的代码运行机制（watchOS1.0），也可以选择基于 watchOS的运行机制（watchOS2.0）。这一点在 Build Setting - Architectures - Base SDK 中设置。Build Setting - Architectures - Architecture ,在debug">
<meta property="og:image" content="https://treasureu.github.io/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/583ba1bcNfde5bbe6.jpg">
<meta property="og:image" content="https://treasureu.github.io/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/F941B72C-048A-4BA1-ADBD-1B612C9B04C2.png">
<meta property="og:updated_time" content="2017-02-09T03:19:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apple Watch开发总结">
<meta name="twitter:description" content="Apple Watch开发总结基本概念：在watch中，我们目前可以选择基于 ios的代码运行机制（watchOS1.0），也可以选择基于 watchOS的运行机制（watchOS2.0）。这一点在 Build Setting - Architectures - Base SDK 中设置。Build Setting - Architectures - Architecture ,在debug">
<meta name="twitter:image" content="https://treasureu.github.io/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/583ba1bcNfde5bbe6.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '6369437447528383000',
      author: '健康哥哥'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://treasureu.github.io/2017/02/09/Apple Watch开发总结/"/>





  <title> Apple Watch开发总结 | Cheng JianFeng's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Cheng JianFeng's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">心有猛虎,细嗅蔷薇.</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th-list"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://treasureu.github.io/2017/02/09/Apple Watch开发总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Cheng JianFeng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/logo.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Cheng JianFeng's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Cheng JianFeng's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Apple Watch开发总结
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-09T11:19:07+08:00">
                2017-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS笔记/" itemprop="url" rel="index">
                    <span itemprop="name">iOS笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/09/Apple Watch开发总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/09/Apple Watch开发总结/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"><meta name="keywords" content="汇总贴"><meta name="author" content="程剑锋"><meta name="created" content="2016-04-06 08:01:50 +0000"><meta name="source-url" content="http://www.jianshu.com/p/3e1b4e2d06c6"><meta name="updated" content="2016-11-29 08:50:57 +0000"><title>Apple Watch开发总结</title></head><body><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><b>基本概念</b>：</div><ul><li>在watch中，我们目前可以选择基于 ios的代码运行机制（watchOS1.0），也可以选择基于 watchOS的运行机制（watchOS2.0）。这一点在 Build Setting - Architectures - Base SDK 中设置。</li><li>Build Setting - Architectures - Architecture ,在debug时设为YES可以加快编译速度，在release是需要设为NO，以确保各个版本都能安装成功。这一个选项是说是否仅生成当前版本可运行的二进制。</li><li>Build Setting - Architectures - Valid Architecture ，需要配置成支持 armv7 arm64 armv7s.</li><li>Build Setting - Deployment 中， ios Deployment Target 决定了什么版本的ios可以安装此watch，而 watchOS Deployment Target 决定了什么版本的watchOS可以支持该软件。</li><li>在基于 watchOS的 SKD中，很多库都是不支持的，需要进行强制变更。</li><li>编译体系类型问题：<a href="http://www.cocoachina.com/ios/20140915/9620.html" target="_blank" rel="external"><a href="http://www.cocoachina.com/ios/20140915/9620.html" target="_blank" rel="external">http://www.cocoachina.com/ios/20140915/9620.html</a></a></li><li>watchKit编程概览：<a href="http://www.cocoachina.com/ios/20141121/10282.html" target="_blank" rel="external">http://www.cocoachina.com/ios/20141121/10282.html<span style="color: rgb(0, 0, 0);">，</span></a><a href="http://www.cocoachina.com/ios/20141121/10282.html" target="_blank" rel="external">其内主要包含三方面内容：app、glance、notification。</a></li><li>对于这类小众平台，请以官方文档作为开发标准，其他任何地方都可能是误导。</li><li>关于watch setting上的显示字段的差异：
</li><ul><li>对于watchOS1.0来说，名字读取的是 主app 的 Info.plist里的 Bundle Name</li><li>对于watchOS2.0来说，名字读取的是 Bundle Display Name.(发生了变化！！！)</li></ul><li><b>在watch收到通知时，为了快速的启动响应app，会在后台默认启动app</b>（即 appdidFinishWithLaunch -&gt; 第一个界面被初始化，但是不会有applicationDidBecomeActive 。如果后续在通知界面直接点击进去app，那么会先触发 handleActionWithIdentifier:forRemoteNotification:,然后再触发applicationDidBecomeActive）。</li><li><b>在watchOS2中，wacth app和watch extension Bundle ID设置问题</b>：
</li><ul><li>watch app bundle ID：可以任意取，与主app没有任何关系</li><li>watch extension bundle identify : 【watch app bundle ID】.watchkitextension
</li><ul><li>等价于：【watch app bundle identify】.watchkitextension、</li></ul><li><b>可能出现的报错</b>：</li><li><b>原因</b>： 因为以前 watch extension是作为手机的 extension存在的，运行在手机上，所以前缀只要是手机bundle id就可以了（之前是 com.360buy.jdmobile.jdAppleWatchExtension ）。但是现在，<b>watch extension 作为watch app的extension (目前来看实现原理是这样的)</b>，就必须要求前缀是 watch的 bundle id（也就是 <br>
com.360buy.jdmobile.jdAppleWatch.watchkitextension<br>
）。</li><li>watchOS1中的设置：extension是作为主app的extension存在的，因此只需要extension的bundle ID前缀为主 app的bundle ID即可。</li></ul></ul><div><br></div><div><br></div><div><b>watch提交APP Store审核</b>：</div><ul><li>图片和iCon要求：
</li><ul><li><img src="/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/583ba1bcNfde5bbe6.jpg" height="426" width="1371"><br></li><li>icon需要一张，图片需要5张【42mm截图】。直接截图可能不符合要求，因为不能含有Alpha通道，将图片转换为JPG可以去除Alpha通道。</li></ul></ul><div><br></div><div><br></div><div><b>基础编程</b>：</div><ul><li>如果希望更改controller左侧上方的标题的颜色，那么就需要在 storyboard 中任意一个controller的File Inspect 的 Interface Builder Document - Global Tint 改为相应的颜色。目前watch的颜色为 FF2E11。</li><li>WCSession在使用过程中发现有以下特点：
</li><ul><li>使用applicationContext可以传递一些固定类型的更新数据（使用的是后台更新方式）：
</li><ul><li>在输出过程中，如果数据一直堆积没有被提交，那么只会更新最后的数据并提交</li><li>相同的数据在传输前会先与之前已传输的数据做校验，如果相同，那么就不会传输数据。</li><li>如果当前app处于关闭状态或者未链接状态，那么会等到app启动时，再进行数据传输。</li><li>如果删除掉watch上的app，那么堆积的未传递消息将不会再传送过去。且之前保存在本地固化的数据也会消失。</li><li><b>等 receive app处于后台运行时，也是可以被交付的。需要做好保护工作。</b></li></ul><li>使用 userInfo 传递信息时：
</li><ul><li>所有传递的信息都会按序排队，并最终传递到配对的app中</li><li>每一条数据都会引发一次回调</li><li><b>等 receive app处于后台运行时，也是可以被交付的。需要做好保护工作。</b></li></ul></ul><li>Watch中与 UIApplication 地位一致的全局应用管理对象是 WKExtension ，分别需要实现的协议方式是 UIApplicationDelegate 和 WKExtensionDelegate 方法。</li></ul><div><br></div><div><br></div><div><b>视图开发指南</b>：</div><ul><li>watch分为两套屏幕大小适配：
</li><ul><li>38mm：272px*340px【4：5】</li><li>42mm：312px*390px【4：5】</li></ul><li>状态栏大小：20pt，即40px</li><li>watch上的布局方式：
</li><ul><li>只能采用group进行相对布局，默认来说，除了group以外，所有元素都是不可重叠的，只能作为leaf元素存在。</li><li>button是一个比较特殊的容器，它有一个属性可以在text 和 group之间切换，即它可以变成一个 group 去进行布局。</li><li>watch在<span style="color: rgb(4, 51, 255);"><b>同一片区域上，不允许同级关系的元素存在，只允许父子关系</b></span>。且非根节点只能是 group 或者是 group形态的button。
</li><ul><li>这就导致了非叶节点的透明度设置，一定会影响到它的叶节点，应该要注意这个特点是否符合预期。如果不符合，则需要设计出图支持。</li></ul></ul><li>group是一个类似于 CSS 中 盒模式的一种布局容器，其拥有以下几个重要特性：
</li><ul><li>方向：默认是横向布局</li><li>Inset：group内的内容的边框大小</li><li>spacing：内容之间的间距</li></ul><li>元素frame设置：
</li><ul><li>width和height可以分为三种情况设置：
</li><ul><li>自适应内容</li><li>相对于容器的大小，可微调。</li><li>固定pt大小</li></ul><li>size分为x和y各有三种情况：（无法指定一个具体的位置）
</li><ul><li>x0：left、center、right</li><li>y0：top、center、bottom</li></ul></ul><li>基本上所有的元素属性设置都分为 通用版、38MM 和 42MM，只有在特定屏幕类型不指定时，才会使用通用版。</li><li>WKInterfaceTable:
</li><ul><li>这个类一旦成为某一个controller的property，那么它的delegate就自动成为这个controller。</li><li>interfaceController中只有以下几个delegate方法：
</li><ul><li>- (void)table:(WKInterfaceTable *)table didSelectRowAtIndex:(NSInteger)rowIndex;</li><li>- (nullable id)contextForSegueWithIdentifier:(NSString *)segueIdentifier inTable:(WKInterfaceTable *)table rowIndex:(NSInteger)rowIndex;</li><li>- (nullable NSArray *)contextsForSegueWithIdentifier:(NSString *)segueIdentifier inTable:(WKInterfaceTable *)table rowIndex:(NSInteger)rowIndex;</li></ul><li>WKInterfaceTable datasource是不存的，需要我们自己手动为其赋值，并为每一行设置界面。一般来说分为以下步骤：
</li><ul><li>在storyboard中画出各种不同的table row，并为每一个table row添加一个管理器类（继承与NSObject）。绘制时，可以设置row的高度、selectable可选中性等。</li><li>在interfaceController 中，WKInterfaceTable setRowType: 或者是 setRowNumber:withType: 来设置row。</li><li>再通过 WKInterfaceTable rowControllerWithIndex: 获取每一个的rowController，并通过它设置每一个row的界面布局。</li></ul><li>当row的高度大于等于一屏时，将导致table是可滚动的，此时可以把高度改为 size to fit content，来使height尽可能的小。当应该要确保布局是从上而下进行的。</li><li>当设置WKInterfaceTable setRowType: 或者是 setRowNumber:withType: 参数为空数组或者0时，列表中无row数据。</li></ul></ul><div><br></div><div><br></div><div><b>常见错误：</b></div><ul><li>在使用本地文件测试消息push时，如果发生 apns json语法错误，那么会报 SPErrorUnknownMessage的错误。</li><li>watch常见的二进制包不存在问题：<a href="http://stackoverflow.com/questions/29972534/failed-to-install-app-error-invalid-bundle-no-apple-watch-binary" target="_blank" rel="external"><a href="http://stackoverflow.com/questions/29972534/failed-to-install-app-error-invalid-bundle-no-apple-watch-binary" target="_blank" rel="external">http://stackoverflow.com/questions/29972534/failed-to-install-app-error-invalid-bundle-no-apple-watch-binary</a></a></li><ul><li>watch OS1 和 OS2 在主app中包含的方式是不同的，在配置了 Target Dependency 后 ，OS1 是在 Embed Extension App 中添加二进制代码，而 OS2是在 Embed Watch Content 中添加二进制代码。</li><li>需要维持它们的info.plist 中 Excutable File 都是${EXECUTABLE_NAME}，否则可能会出错。</li><li>ios Deployment Target设置的 和 主app的版本不一致。</li><li>也有一种说法是说这是 watchOS1 自带的bug。</li></ul><li>watch单独编译是没有意义的，一定要先在xcode上运行手机Target，然后再切换到手表target，这样才能正确的获取到最新的watch代码编译程序。</li></ul><div><br></div><div><br></div><div><b>WatchConnectivity框架使用</b>：</div><ul><li>关于watch中几个状态变量的描述：
</li><ul><li><b>paired</b>: 判断是否配对，这个变量<b>只有在 session activation 后才可以正常使用</b>。并不是表示手机和手表是否处于实时连接状态，只是表示手机是否有相应配对的手表。</li><li><b>install</b>: 判断手表app是否安装，这个变量<b>只有在 session activation 后才可以正常使用</b>。这个变量在手表和手机断开实时连接后，会默认变为NO。</li><li><b>reachable</b>: 判断手机app和手表app是否处于实时可通信状态。这个变量<b>只有在 session activation 后才可以正常使用</b>。只有这个值为YES的时候才可以使用 sendMessage 发送实时消息。两边的判断依据是不一样的：
</li><ul><li><span style="color: rgb(65, 65, 65); font-family: Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">In your <b>WatchKit extension</b>, the value of this property is </span><code style="background-color: transparent; border: 0px; font-size: 0.85em; outline: 0px; padding: 0px; vertical-align: baseline; color: rgb(128, 128, 128); font-family: Menlo, monospace; word-wrap: break-word; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">YES</code><span style="color: rgb(65, 65, 65); font-family: Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;"> when a matching session is active on the user’s iPhone and the device is within range so that communication may occur.</span></li><li><span style="color: rgb(65, 65, 65); font-family: Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">On <b>iOS</b>, the value is </span><code style="background-color: transparent; border: 0px; font-size: 0.85em; outline: 0px; padding: 0px; vertical-align: baseline; color: rgb(128, 128, 128); font-family: Menlo, monospace; word-wrap: break-word; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">YES</code><span style="color: rgb(65, 65, 65); font-family: Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;"> when a paired and active Apple Watch is in range and the associated Watch app is running in the foreground. In all other cases, the value is </span><code style="background-color: transparent; border: 0px; font-size: 0.85em; outline: 0px; padding: 0px; vertical-align: baseline; color: rgb(128, 128, 128); font-family: Menlo, monospace; word-wrap: break-word; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">NO</code><span style="color: rgb(65, 65, 65); font-family: Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">.</span></li></ul><li><b>activationState</b>: 表示当前session的 activation 状态。</li></ul><li>当发起实时连接时，如果配对的手机app没有启动，那么<b>将在后台被唤醒（且一定可以被唤醒</b>）。被唤醒时的主要函数调用为：
</li><ul><li>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</li><li>- (void)session:(nonnull WCSession *)session didReceiveMessage:(nonnull NSDictionary&lt;NSString *,id&gt; *)message replyHandler:(nonnull void (^)(NSDictionary&lt;NSString *,id&gt; * __nonnull))replyHandler</li></ul><li>当使用实时消息唤醒iPhone App时，在 application:didFinishLaunchingWithOptions: 中传入的 launchOptions 为 nil，与用户手动点击的状态一致。但是可以区分的是，<b>当用户手动点击启动时，在这个函数中，applicationState 状态是UIApplicationStateInactive，但是当后台唤醒时，applicationState 状态是UIApplicationStateBackground，且不会再进入- (void)applicationDidEnterBackground:(UIApplication *)application 函数。由此可以用来设置标志位，标记到底是源于什么原因的启动。</b></li><li>当蓝牙断开重连后，大概需要30s的时间，去建立一个稳定的session链接，在30s内，任何消息的发送（特别是实时消息）都有可能会失败。且比较诡异的事是，稳定的网络链接，将比稳定的session链接更早的建立（一重连完成就建立了）。</li><li><b>tableView界面不刷新问题</b>：
</li><ul><li>发生时机：当页面不是界面栈的栈顶，即非展示页面时，对该页面的tableView进行UI刷新，会发现操作无法生效。</li><li>原因：系统bug导致。</li><li>解决方案：在页面willActive时，对页面进行刷新操作。【可以增加附加条件，控制刷新数量】</li></ul></ul><div><br></div><div><br></div><div><b>WatchOS2.0开发笔记</b>：</div><ul><li>watchOS的基础架构发生了变化，target请使用以下设置：<img src="/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/F941B72C-048A-4BA1-ADBD-1B612C9B04C2.png" height="410" width="1358"><br></li><li>watchOS可以引用的系统库急剧减少，请依次check后再添加。</li><li><b>App Group 在watchOS2.0时不可用</b>。</li><li>watch2.0中，<b>通知的生命周期</b>如下：（这也将意味着 <b>自定义通知展示时，后台是默认打开了app了</b>）
</li><ul><li>watch notification controller  的以下两个函数之一：
</li><ul><li>- (void)didReceiveRemoteNotification:(NSDictionary *)remoteNotification withCompletion:(void(^)(WKUserNotificationInterfaceType interface)) completionHandler;</li><li>- (void)didReceiveLocalNotification:(UILocalNotification *)localNotification withCompletion:(void(^)(WKUserNotificationInterfaceType interface)) completionHandler;</li></ul></ul></ul><div>                     将会最先先被调用。</div><ul><ul><li>然后是 watch notification controller 的 willActive 生命周期函数被调用。注意，watch notification controller 的 awakeContext 函数不会被调用！</li><li>接着是 watch appdelegate 的 appDidFinishWithLaunch 函数被调用，接下去的流程与正常打开app一致。</li><li>然后就是在后台正常的加载 第一个 Interface Controller。</li></ul></ul><div><br></div><div><br></div><div><b>watchOS2.0 第三方库打包方式</b>：</div><ul><li>最好使用单独的watch framework设置，在生成target时可以单独选择</li><li>第三方库必须包含架构armv7k，且supported platforms必须是watchOS,base sdk选为 latest watchOS。（如果使用watch framework target设置，那么这些都是默认设置）。 否则会出现警告:building for watchOS simulator, but linking in object file built for iOS, for architecture i386.</li><li>watch framework必须支持bitcode设置，因此，<b>我们需要在 Other linker flag 、 Other C flag 和 Other C++ flag 中添加 -fembed-bitcode 参数</b>。
</li><ul><li>watch设置详情：<a href="http://stackoverflow.com/questions/32868297/compiling-ios-library-with-bitcode-enabled" target="_blank" rel="external">http://stackoverflow.com/questions/32868297/compiling-ios-library-with-bitcode-enabled</a></li><li>参数具体含义解析：<a href="http://stackoverflow.com/questions/31233395/ios-library-to-bitcode" target="_blank" rel="external">http://stackoverflow.com/questions/31233395/ios-library-to-bitcode</a></li></ul><li>在 build setting 中 正确的设置 ios Deployment target 和 watch Deploment target 两个选项。</li><li>watch可以使用静态库，也可以使用动态库。但推荐使用静态库。</li></ul><div><br></div><div><br></div><div><b>参考文章</b>：</div><div><a href="/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/iPhone%E5%BC%80%E5%8F%91%E5%90%8C%E4%BA%8B%E9%85%8D%E7%BD%AEWatch%20target%E7%9A%84%E5%BB%BA%E8%AE%AE.docx">iPhone开发同事配置Watch target的建议.docx</a><br></div><div><a href="/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/watchTarget%E9%85%8D%E7%BD%AE%E8%A6%81%E7%82%B9.docx">watchTarget配置要点.docx</a><br></div><div><a href="/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/%E8%8B%B9%E6%9E%9C%E6%B6%88%E6%81%AF%E6%B5%8B%E8%AF%95%E6%80%BB%E7%BB%93.docx">苹果消息测试总结.docx</a><br></div><div><a href="/Resources/Apple%20Watch%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93.resources/Watch%E5%BC%80%E5%8F%91%E5%88%86%E4%BA%AB.pptx">Watch开发分享.pptx</a><br></div><div><br></div></div><div><br></div></body></html>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/weixin_pay.JPG" alt="Cheng JianFeng WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/zhifubao_pay.JPG" alt="Cheng JianFeng Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/08/iOS核心动画高级编程：读书笔记/" rel="next" title="iOS核心动画高级编程：读书笔记">
                <i class="fa fa-chevron-left"></i> iOS核心动画高级编程：读书笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/09/IOS设备分辨率及常见控件的尺寸/" rel="prev" title="IOS设备分辨率及常见控件的尺寸">
                IOS设备分辨率及常见控件的尺寸 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2017/02/09/Apple Watch开发总结/"
     data-title="Apple Watch开发总结"
     data-content=""
     data-url="https://treasureu.github.io/2017/02/09/Apple Watch开发总结/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/02/09/Apple Watch开发总结/"
           data-title="Apple Watch开发总结" data-url="https://treasureu.github.io/2017/02/09/Apple Watch开发总结/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/logo.jpg"
               alt="Cheng JianFeng" />
          <p class="site-author-name" itemprop="name">Cheng JianFeng</p>
          <p class="site-description motion-element" itemprop="description">iOS,Python,Unity</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">74</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/TreasureU" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://treasureu.github.io/" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://treasureu.github.io/" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://treasureu.github.io/" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  简书
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cheng JianFeng</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ChengJianFeng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js?v=5.1.0"></script>
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  










  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


</body>
</html>
